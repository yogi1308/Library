
// clicking on the dots will enable you to add a genre and a summary, a review, and a rating, and favorite
// add a dark mode
// make the sort button work in ascending and descending order

Vagabond = new Book('Vagabond', 'Takehiko Inoue', 'Completed', 327, 'Chapters', 'https://d28hgpri8am2if.cloudfront.net/book_images/onix/cvr9781421577449/vagabond-vol-37-9781421577449_hr.jpg', 'Vagabond is a Japanese manga series written and illustrated by Takehiko Inoue. It portrays a fictionalized account of the life of Japanese swordsman Musashi Miyamoto, based on Eiji Yoshikawa\'s novel Musashi. The story delves into Musashi\'s journey from a brash young man to a legendary swordsman, exploring themes of self-discovery, the pursuit of greatness, and the philosophical aspects of martial arts. It has been serialized in Weekly Morning magazine since 1998, with the chapters collected into 37 tankōbon volumes by Kodansha as of September 2020.', 'true', 'Vagabond is an absolute masterpiece that transcends the boundaries of traditional manga storytelling. Takehiko Inoue\'s art is breathtakingly detailed, capturing the raw emotion and intensity of Musashi Miyamoto\'s journey. The philosophical depth and exploration of self-discovery make this series a profound and thought-provoking read. It\'s a story that stays with you long after you\'ve turned the last page, leaving you contemplating the true meaning of greatness and the path to achieving it.', 10);

TheSlamDunk = new Book('The Slam Dunk', 'Takehiko Inoue', 'Started', 276, 'Chapters', 'https://d28hgpri8am2if.cloudfront.net/book_images/cvr9781421533285_9781421533285_hr.jpg', 'Slam Dunk is a Japanese manga series written and illustrated by Takehiko Inoue about a basketball team from Shōhoku High School in the Shōnan area. The story follows Hanamichi Sakuragi, a delinquent and basketball novice, as he joins the school\'s basketball team to impress a girl he likes. Through hard work, determination, and the guidance of his teammates and coach, Hanamichi grows as a player and person, learning valuable life lessons along the way. It was serialized in Shueisha\'s Weekly Shōnen Jump from October 1990 to June 1996, with the chapters collected into 31 tankōbon volumes.', 'true', 'Slam Dunk is an exhilarating journey that captures the essence of youth, ambition, and the transformative power of sports. Takehiko Inoue masterfully portrays the growth of Hanamichi Sakuragi from a brash delinquent to a dedicated basketball player. The series is filled with intense matches, heartfelt moments, and a cast of characters that you can\'t help but root for. It\'s a motivational and uplifting story that reminds us of the importance of perseverance and teamwork.', 9);

Berserk = new Book('Berserk', 'Kentaro Miura', 'Completed', 364, 'Chapters', 'https://images.booksense.com/images/205/070/9781593070205.jpg', 'Berserk is a Japanese manga series written and illustrated by Kentaro Miura. Set in a medieval Europe-inspired dark fantasy world, the story centers on the characters of Guts, a lone mercenary, and Griffith, the leader of a mercenary band called the Band of the Hawk. The series explores themes of camaraderie, ambition, and the struggle between good and evil, as Guts battles against both human and supernatural foes. Miura premiered a prototype of Berserk in 1988, and the series has since become renowned for its dark, mature themes and intricate artwork.', 'true', 'Berserk is a dark and gripping tale that delves into the depths of human nature and the eternal struggle between good and evil. Kentaro Miura\'s intricate artwork and complex characters create a world that is both brutal and beautiful. The story of Guts and Griffith is one of ambition, betrayal, and the relentless pursuit of power. It\'s a series that challenges the reader to confront their own beliefs and question the nature of destiny. Berserk is a masterpiece that leaves a lasting impact on all who read it.', 10);

OnePiece = new Book('One Piece', 'Eiichiro Oda', 'Completed', 1000, 'Chapters', 'https://comicvine.gamespot.com/a/uploads/scale_small/11161/111610434/8594314-9160985681-97840.jpg', 'One Piece is a Japanese manga series written and illustrated by Eiichiro Oda. It follows the adventures of Monkey D. Luffy, a boy whose body gained the properties of rubber after unintentionally eating a Devil Fruit. With his pirate crew, Luffy explores the Grand Line in search of the world\'s ultimate treasure known as "One Piece" in order to become the next Pirate King. The series is known for its imaginative world-building, diverse cast of characters, and themes of friendship, freedom, and the pursuit of dreams.', 'true', 'One Piece is an epic and adventurous saga that has captured the hearts of millions around the world. Eiichiro Oda\'s imaginative world-building and diverse cast of characters create a story that is both thrilling and heartwarming. The journey of Monkey D. Luffy and his crew is filled with excitement, humor, and profound moments of friendship and sacrifice. One Piece is a celebration of the human spirit and the unyielding pursuit of dreams. It\'s a series that inspires and entertains, leaving readers eagerly anticipating each new chapter.', 10);

SteelBallRun = new Book('Steel Ball Run', 'Hirohiko Araki', 'Started', 95, 'Chapters', 'https://m.media-amazon.com/images/I/917WFqQD1mL._AC_UF1000,1000_QL80_.jpg', 'Steel Ball Run is the seventh story arc of the Japanese manga series JoJo\'s Bizarre Adventure, written and illustrated by Hirohiko Araki. Set in 1890, it stars Gyro Zeppeli, a disgraced former executioner, and Johnny Joestar, a former jockey who was shot and lost the use of his legs. The two participate in the Steel Ball Run, a cross-country horse race across America, in pursuit of the grand prize and personal redemption. The series blends historical fiction with supernatural elements, and explores themes of perseverance, friendship, and the human spirit.', 'true', 'Steel Ball Run is a unique and thrilling adventure that blends historical fiction with supernatural elements. Hirohiko Araki\'s storytelling is both imaginative and compelling, creating a world that is rich in detail and filled with memorable characters. The journey of Gyro Zeppeli and Johnny Joestar is one of perseverance, friendship, and personal redemption. Steel Ball Run is a testament to the human spirit and the power of determination. It\'s a series that keeps you on the edge of your seat, eagerly anticipating each new twist and turn.', 9);

ChainsawMan = new Book('Chainsaw Man', 'Tatsuki Fujimoto', 'Completed', 97, 'Chapters', 'https://images.booksense.com/images/785/722/9781974722785.jpg', 'Chainsaw Man is a Japanese manga series written and illustrated by Tatsuki Fujimoto. The story follows Denji, a young man who merges with his pet devil Pochita to become the titular Chainsaw Man. As a devil hunter, Denji battles against various devils while navigating the complexities of human relationships and his own desires. The series is known for its dark humor, intense action scenes, and exploration of themes such as poverty, ambition, and the nature of humanity.', 'true', 'Chainsaw Man is a dark and humorous series that pushes the boundaries of conventional storytelling. Tatsuki Fujimoto\'s unique art style and narrative approach create a world that is both chaotic and captivating. The story of Denji and his journey as Chainsaw Man is filled with intense action scenes, dark humor, and moments of profound introspection. It\'s a series that explores the complexities of human relationships and the nature of ambition. Chainsaw Man is a wild ride that keeps you hooked from start to finish.', 8);

VinLandSaga = new Book('Vinland Saga', 'Makoto Yukimura', 'Completed', 54, 'Chapters', 'https://m.media-amazon.com/images/I/91+Qs9DaFZL.jpg', 'Vinland Saga is a Japanese historical manga series written and illustrated by Makoto Yukimura. The series is published by Kodansha, and was first serialized in the youth-targeted Weekly Shōnen Magazine before moving to the monthly manga magazine Afternoon, aimed at young adult readers. The story is set in 11th-century Europe and follows Thorfinn, a young Viking warrior, as he seeks revenge against the mercenary leader Askeladd, who killed his father. The series explores themes of revenge, redemption, and the harsh realities of Viking life.', 'true', 'Vinland Saga is a historical and engaging series that transports readers to the harsh and unforgiving world of 11th-century Europe. Makoto Yukimura\'s meticulous attention to detail and deep understanding of Viking culture create a story that is both authentic and captivating. The journey of Thorfinn as he seeks revenge and ultimately finds redemption is a powerful and emotional tale. Vinland Saga is a series that explores the complexities of human nature and the consequences of violence. It\'s a gripping and thought-provoking read that leaves a lasting impression.', 9);

TheAlchemist = new Book('The Alchemist', 'Paulo Coelho', 'Unread', 197, 'Pages', 'https://i.harperapps.com/hcuk/covers/9780007487943/x400.jpg?ph=harperreach_coming_soon.png', 'The Alchemist is a novel by Brazilian author Paulo Coelho that was first published in 1988. Originally written in Portuguese, it became a widely translated international bestseller. An allegorical novel, The Alchemist follows a young Andalusian shepherd named Santiago in his journey to the pyramids of Egypt, after having a recurring dream of finding a treasure there. Along the way, he meets various characters who guide him and teach him about the importance of following one\'s dreams, listening to one\'s heart, and recognizing the omens scattered along life\'s path.', '', '', '');

TheHobbit = new Book('The Hobbit', 'J.R.R. Tolkien', 'Unread', 310, 'Pages', 'https://m.media-amazon.com/images/I/712cDO7d73L.jpg' , 'The Hobbit, or There and Back Again is a children\'s fantasy novel by English author J. R. R. Tolkien. It was published on 21 September 1937 to wide critical acclaim, being nominated for the Carnegie Medal and awarded a prize from the New York Herald Tribune for best juvenile fiction. The book remains popular and is recognized as a classic in children\'s literature. The story follows the journey of Bilbo Baggins, a hobbit who is reluctantly drawn into an epic quest to reclaim the lost Dwarf Kingdom of Erebor from the fearsome dragon Smaug.', '', '', 0);

TheGreatGatsby = new Book('The Great Gatsby', 'F. Scott Fitzgerald', 'Unread', 180, 'Pages', 'https://m.media-amazon.com/images/I/61OTNorhqVS._AC_UF894,1000_QL80_.jpg', 'The Great Gatsby is a 1925 novel by American writer F. Scott Fitzgerald. Set in the Jazz Age on Long Island, near New York City, the novel depicts first-person narrator Nick Carraway\'s interactions with mysterious millionaire Jay Gatsby and Gatsby\'s obsession to reunite with his former lover, Daisy Buchanan. The novel explores themes of decadence, idealism, resistance to change, social upheaval, and excess, creating a portrait of the Roaring Twenties that has been described as a cautionary tale regarding the American Dream.', '', '', '');

TheHungerGames = new Book('The Hunger Games', 'Suzanne Collins', 'Unread', 374, 'Pages', 'https://m.media-amazon.com/images/I/71un2hI4mcL.jpg', 'The Hunger Games is a 2008 dystopian novel by the American writer Suzanne Collins. It is written in the voice of 16-year-old Katniss Everdeen, who lives in the future, post-apocalyptic nation of Panem in North America. The Capitol, a highly advanced metropolis, exercises political control over the rest of the nation. The story follows Katniss as she volunteers to take her sister\'s place in the Hunger Games, a televised event in which children fight to the death. The novel explores themes of survival, government control, and the effects of violence on society.', '', '', '');

TheLordOfTheRings = new Book('The Lord of the Rings', 'J.R.R. Tolkien', 'Unread', 1178, 'Pages', 'https://s26162.pcdn.co/wp-content/uploads/2017/05/the-lord-of-the-rings-book-cover.jpg', 'The Lord of the Rings is an epic high-fantasy novel by the English author and scholar J. R. R. Tolkien. Set in Middle-earth, the world at some distant time in the past, the story began as a sequel to Tolkien\'s 1937 children\'s book The Hobbit, but eventually developed into a much larger work. The novel is divided into three volumes: The Fellowship of the Ring, The Two Towers, and The Return of the King. It follows the quest to destroy the One Ring, which was created by the Dark Lord Sauron, and the journey of the hobbit Frodo Baggins and his companions.', '', '', '');
TheSilmarillion = new Book('The Silmarillion', 'J.R.R. Tolkien', 'Unread', 365, 'Pages', 'https://m.media-amazon.com/images/I/71Gt0U59D3L._AC_UF894,1000_QL80_.jpg', 'The Silmarillion is a collection of mythopoeic works by English writer J. R. R. Tolkien, edited and published posthumously by his son, Christopher Tolkien, in 1977, with assistance from Guy Gavriel Kay. It is the primary and essential source material for Tolkien\'s Middle-earth legendarium. The book includes several works, the most prominent of which is the "Quenta Silmarillion," which tells the history of the First Age of Middle-earth, including the creation of the world, the rise and fall of the great Elven kingdoms, and the wars against the dark lord Morgoth.', '', '', '');

TheTwoTowers = new Book('The Two Towers', 'J.R.R. Tolkien', 'Unread', 322, 'Pages', 'https://m.media-amazon.com/images/I/71nNxfSvGnL._UF1000,1000_QL80_.jpg', 'The Two Towers is the second volume of J.R.R. Tolkien\'s high fantasy novel The Lord of the Rings. It is preceded by The Fellowship of the Ring and followed by The Return of the King. The story continues the quest to destroy the One Ring, following the separate journeys of the members of the Fellowship after they are scattered. The volume is divided into two books: Book Three, which focuses on the adventures of Aragorn, Legolas, Gimli, Merry, and Pippin, and Book Four, which follows Frodo and Sam as they make their way to Mordor.', '', )

TheFellowshipOfTheRing = new Book('The Fellowship of the Ring', 'J.R.R. Tolkien', 'Unread', 398, 'Pages', 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQoX5QopXUKl6j79ro89axxAkcC253ryvX7Gg&shttps://ic.pics.livejournal.com/tree_lady/14285127/10506/10506_600.jpg', 'The Fellowship of the Ring is the first of three volumes of the epic novel The Lord of the Rings by the English author J. R. R. Tolkien. It is followed by The Two Towers and The Return of the King. The story begins in the Shire, where the hobbit Frodo Baggins inherits the One Ring from his uncle Bilbo. Frodo sets out on a journey to destroy the Ring, accompanied by his friends Sam, Merry, and Pippin, and later joined by Aragorn, Legolas, Gimli, Boromir, and Gandalf. Together, they form the Fellowship of the Ring, united in their quest to save Middle-earth.', '', '', '')

TheReturnOfTheKing = new Book('The Return of the King', 'J.R.R. Tolkien', 'Unread', 347, 'Pages', 'https://www.knjizara-dominovic.hr/upload/catalog/product/8086/249042_the-return-ofthe-king-the-lord-of-the-rings-book-3-return-of-the-king-vol3.jpg', 'The Return of the King is the third and final volume of J.R.R. Tolkien\'s The Lord of the Rings, following The Fellowship of the Ring and The Two Towers. The story begins in the kingdom of Gondor, which is soon to be attacked by the Dark Lord Sauron. The volume is divided into two books: Book Five, which focuses on the war in Gondor and the efforts of Aragorn, Gandalf, and their allies to defend the city, and Book Six, which follows Frodo and Sam as they make their final journey to Mount Doom to destroy the One Ring. The novel concludes with the defeat of Sauron and the restoration of peace to Middle-earth.', '', '')


myLibrary = [Vagabond, TheSlamDunk, Berserk, OnePiece, SteelBallRun, ChainsawMan, VinLandSaga, TheAlchemist, TheHobbit, TheGreatGatsby, TheHungerGames, TheLordOfTheRings, TheSilmarillion, TheTwoTowers, TheFellowshipOfTheRing, TheReturnOfTheKing];
function Book(title, author, status, length, lengthType, cover, synopsis, favorite, review, rating) {
  // the constructor...
  this.title = title
  this.author = author 
  this.status = status
  this.length = length
  this.lengthType = lengthType
  this.cover = cover
  this.synopsis = synopsis
  this.favorite = favorite
  this.review = review
  this.rating = rating
}

const theme = document.querySelector(".material-symbols-outlined")
theme.addEventListener("click", changeTheme)
theme.style.cursor = "pointer"

const verticalDots = document.querySelector(".vertical-dots")
verticalDots.addEventListener("click", displayType)
verticalDots.style.cursor = "pointer"

const sort = document.querySelector(".sort")
sort.addEventListener("click", sortBooks)

const search = document.querySelector(".search")
search.addEventListener("click", searchBooks)

const searchBar = document.querySelector("#search-input")
searchBar.addEventListener("keydown", (event) => {if (event.key === "Enter") {searchBooks()}});

const library = document.querySelector(".header > p")
library.addEventListener("click", () => {main.innerHTML = ""; myLibrary.forEach(book => {if (viewType == "regular") {displayBooks(book)} else if (viewType == "compact") {displayCompactBooks(book)} else if (viewType == "list") {listView(book)}})})

let viewType = "regular"

function searchBooks(event) {
  const searchContainer = document.querySelector(".search-container")
  if (searchContainer.style.display == "flex") {searchContainer.style.display = "none"}
  else if (search.style.display == "none" || search.style.display == "") {
    searchContainer.style.display = "flex";
  }
  const searchInput = document.querySelector("#search-input")
  searchedArray = new Array();
  myLibrary.forEach(book => {
  if (book.title.toLowerCase().includes(searchInput.value.toLowerCase()) || book.author.toLowerCase().includes(searchInput.value.toLowerCase())) {
    main.innerHTML = "";
    searchedArray.push(book);
  }
  });

  if (searchedArray.length == 0) {
    main.innerHTML = "";
    const noResults = document.createElement("div")
    noResults.textContent = "No results found"
    noResults.style.fontSize = "24px"
    noResults.style.fontWeight = "bold"
    main.appendChild(noResults)
  }
  searchedArray.forEach(book => {if (viewType == "regular") {displayBooks(book)} else if (viewType == "compact") {displayCompactBooks(book)} else if (viewType == "list") {listView(book)}})
  addDarkClass()
}

function sortBooks(event) {
  const list = document.querySelector("ol")

  if (list.style.display == "block") {list.style.display = "none"}
  else if (list.style.display == "none" || list.style.display == "") {
    list.style.display = "block";
  }

  const sortReadingStatus = document.querySelector(".header > div:nth-child(3) > ol > div")
  sortReadingStatus.addEventListener("mouseenter", sortByStatus)

  list.addEventListener("click", (event) => {
    if (event.target.textContent === "By Title") {
      const titleSortArray = [...myLibrary].sort((a, b) => a.title.localeCompare(b.title));
      main.innerHTML = "";
      titleSortArray.forEach(book => {if (viewType == "regular") {displayBooks(book)} else if (viewType == "compact") {displayCompactBooks(book)} else if (viewType == "list") {listView(book)}})
    }
    else if (event.target.textContent === "By Author Name") {
      AuthorSortArray = [...myLibrary].sort((a, b) => a.author.localeCompare(b.author));
      main.innerHTML = "";
      AuthorSortArray.forEach(book => {if (viewType == "regular") {displayBooks(book)} else if (viewType == "compact") {displayCompactBooks(book)} else if (viewType == "list") {listView(book)}})
    }
    else if (event.target.textContent === "Date Added") {
      main.innerHTML = ""
      myLibrary.forEach(book => {if (viewType == "regular") {displayBooks(book)} else if (viewType == "compact") {displayCompactBooks(book)} else if (viewType == "list") {listView(book)}})
    }
    else if (event.target.textContent === "Favorites") {
      favoriteSort = [...myLibrary].filter(book => book.favorite === 'true')
      main.innerHTML = ""
      favoriteSort.forEach(book => {if (viewType == "regular") {displayBooks(book)} else if (viewType == "compact") {displayCompactBooks(book)} else if (viewType == "list") {listView(book)}})
    }
    else if (event.target.textContent === "By Reading Status •") {
      const statusList = document.querySelector(".header > div:nth-child(3) > ol > div > ol")
      statusList.style.display = "block"
      statusList.addEventListener("mouseenter", (event) => {statusList.style.display = "block";sortByStatus(event)})
      statusList.addEventListener("mouseleave", (event) => {statusList.style.display = "none"})
    }
  })
  list.addEventListener("mouseenter", (event) => {list.style.display = "block"})
  list.addEventListener("mouseleave", (event) => {list.style.display = "none"; const statusList = document.querySelector(".header > div:nth-child(3) > ol > div > ol"); statusList.style.display = "none"})
}

function sortByStatus(event) {
  const status = document.querySelector("body > div.container > div.header > div:nth-child(3) > ol > div > ol")
  status.addEventListener("click", (event) => {
    if (event.target.textContent === "Unread") {
      sortUnreadBooks = new Array();
      sortUnreadBooks = myLibrary.filter(book => book.status === "Unread")
      main.innerHTML = "";
      sortUnreadBooks.forEach(book => {if (viewType == "regular") {displayBooks(book)} else if (viewType == "compact") {displayCompactBooks(book)} else if (viewType == "list") {listView(book)}})
    }
    else if (event.target.textContent === "Started") {
      sortStartedBooks = new Array();
      sortStartedBooks = myLibrary.filter(book => book.status === "Started")
      main.innerHTML = "";
      sortStartedBooks.forEach(book => {if (viewType == "regular") {displayBooks(book)} else if (viewType == "compact") {displayCompactBooks(book)} else if (viewType == "list") {listView(book)}})
    }
    else if (event.target.textContent === "Completed") {
      sortCompletedBooks = new Array();
      sortCompletedBooks = myLibrary.filter(book => book.status === "Completed")
      main.innerHTML = "";
      sortCompletedBooks.forEach(book => {if (viewType == "regular") {displayBooks(book)} else if (viewType == "compact") {displayCompactBooks(book)} else if (viewType == "list") {listView(book)}})
    }
  })
}

function displayType(event) {
  const displayList = document.querySelector(".display-list")
  if (displayList.style.display == "block") {displayList.style.display = "none"}
  else if (displayList.style.display == "none" || displayList.style.display == "") {
    displayList.style.display = "block";
  }

  displayList.addEventListener("click", (event) => {
    if (event.target.textContent == "Regular Grid") {
      main.innerHTML = ""
      main.style = ""
      myLibrary.forEach(book => {if (viewType == "regular") {displayBooks(book)} else if (viewType == "compact") {displayCompactBooks(book)} else if (viewType == "list") {listView(book)}})
      viewType = "regular"
    }
    else if (event.target.textContent == "Compact Grid") {
      const main = document.querySelector('.main')
      main.innerHTML = ""
      main.style.display = "grid"
      main.style.gridTemplateColumns = "repeat(auto-fill, minmax(100px, 0.5fr))"
      main.style.gridGap = "10px"
      main.style.fontSize = "10px";
      myLibrary.forEach(book => {displayCompactBooks(book)})
      const deleteButtons = document.querySelectorAll(".deleteButton")
      deleteButtons.forEach(button => {button.style.position = "relative"; button.style.left = "80%"; button.style.backgroundColor = "rgba(265, 265, 265, 0.5)"; button.style.padding = "0"})
      viewType = "compact"
    }
    else if (event.target.textContent == "List View") {
      viewType = "list"
      const main = document.querySelector(".main")
      main.innerHTML = ""
      main.style = ""
      main.style.display = "block" // Change to block for list view
      myLibrary.forEach(book => {listView(book)})
    }
  })


  displayList.addEventListener("mouseenter", (event) => {displayList.style.display = "block"})
  displayList.addEventListener("mouseleave", (event) => {displayList.style.display = "none"})
}


function displayBooks(currBook) {
    const main = document.querySelector(".main")

    const book = document.createElement("div")
    book.classList.add("book")

    const cover = document.createElement("div")
    cover.classList.add("book-cover")
    cover.style.backgroundImage = `url(${currBook.cover})`
    cover.style.backgroundSize = "cover"
    cover.style.backgroundPosition = "center"
    cover.addEventListener("mouseenter", bookCoverHover); 
    cover.addEventListener("mouseleave", bookCoverMouseOut); 
    cover.addEventListener("click", bookCoverClick); 

    const deleteButton = document.createElement("button");
    deleteButton.classList.add("deleteButton");

    const svg = document.createElementNS("http://www.w3.org/2000/svg", "svg");
    svg.setAttribute("viewBox", "0 0 15 17.5");
    svg.setAttribute("height", "17.5");
    svg.setAttribute("width", "15");
    svg.setAttribute("xmlns", "http://www.w3.org/2000/svg");
    svg.classList.add("icon");

    const iconPath = document.createElementNS("http://www.w3.org/2000/svg", "path");
    iconPath.setAttribute("transform", "translate(-2.5 -1.25)");
    iconPath.setAttribute("d", "M15,18.75H5A1.251,1.251,0,0,1,3.75,17.5V5H2.5V3.75h15V5H16.25V17.5A1.251,1.251,0,0,1,15,18.75ZM5,5V17.5H15V5Zm7.5,10H11.25V7.5H12.5V15ZM8.75,15H7.5V7.5H8.75V15ZM12.5,2.5h-5V1.25h5V2.5Z");
    iconPath.setAttribute("id", "Fill");

    svg.appendChild(iconPath);
    deleteButton.appendChild(svg);
    cover.appendChild(deleteButton);
    deleteButton.addEventListener("click", deleteButtonClick)

    const likeLabel = document.createElement("label");
    likeLabel.classList.add("like");
    
    const likeInput = document.createElement("input");
    likeInput.type = "checkbox";
    likeInput.addEventListener("click", likeClicked)
    
    const likeSvg = document.createElementNS("http://www.w3.org/2000/svg", "svg");
    likeSvg.setAttribute("id", "Layer_1");
    likeSvg.setAttribute("version", "1.0");
    likeSvg.setAttribute("viewBox", "0 0 24 24");
    likeSvg.setAttribute("xml:space", "preserve");
    likeSvg.setAttribute("xmlns", "http://www.w3.org/2000/svg");
    likeSvg.setAttribute("xmlns:xlink", "http://www.w3.org/1999/xlink");
    
    const likePath = document.createElementNS("http://www.w3.org/2000/svg", "path");
    likePath.setAttribute("d", "M16.4,4C14.6,4,13,4.9,12,6.3C11,4.9,9.4,4,7.6,4C4.5,4,2,6.5,2,9.6C2,14,12,22,12,22s10-8,10-12.4C22,6.5,19.5,4,16.4,4z");
    
    likeSvg.appendChild(likePath);
    likeLabel.appendChild(likeInput);
    likeLabel.appendChild(likeSvg);
    cover.appendChild(likeLabel);

    if (currBook.favorite == 'true') {likeSvg.style.fill = "#E3474F"}

    book.appendChild(cover)

    const details = document.createElement("div")
    details.classList.add("book-details")
    book.appendChild(details)

    const title_author = document.createElement("div")

    const title = document.createElement("p")
    title.addEventListener("click", editTitle)
    title.textContent = currBook.title
    title.style.fontSize = "18px"
    title_author.appendChild(title)

    const author = document.createElement("p")
    author.textContent = currBook.author
    author.style.color = "gray"
    author.style.fontSize = "16px"
    author.addEventListener("click", editAuthor)
    title_author.appendChild(author)

      

    const length = document.createElement("div")
    const lengthValue = document.createElement("span")
    lengthValue.textContent = currBook.length
    length.style.fontSize = "14px"
    lengthValue.addEventListener("click", editLength)
    length.appendChild(lengthValue)
    const lengthType = document.createElement("span")
    lengthType.textContent = " "+currBook.lengthType
    lengthType.addEventListener("click", editLengthType)
    length.appendChild(lengthType)
    title_author.appendChild(length)

    const status = document.createElement("p")
    if (currBook.status === "Unread") {
        status.textContent = "Unread"
        status.style.color = "red"
    }
    else if (currBook.status === "Started") {
        status.textContent = "Started"
        status.style.color = "blue"
    }
    else {
        status.textContent = "Completed"
        status.style.color = "green"
    }

    status.style.fontSize = "14px"
    status.addEventListener("click", statusChange)


    title_author.appendChild(status)

    details.appendChild(title_author)

    const dotsDiv = document.createElement("div")
    dotsDiv.classList.add("dotsDiv")
    
    const buttons = document.createElementNS("http://www.w3.org/2000/svg", "svg");
    buttons.classList.add("three-vertical-dots");
    buttons.style.cursor = "pointer";
    buttons.setAttribute("xmlns", "http://www.w3.org/2000/svg");
    buttons.setAttribute("viewBox", "0 0 24 24");
    const titleElement = document.createElementNS("http://www.w3.org/2000/svg", "title");
    titleElement.textContent = "dots-vertical";
    buttons.appendChild(titleElement);

    const path = document.createElementNS("http://www.w3.org/2000/svg", "path");
    path.setAttribute("d", "M12,16A2,2 0 0,1 14,18A2,2 0 0,1 12,20A2,2 0 0,1 10,18A2,2 0 0,1 12,16M12,10A2,2 0 0,1 14,12A2,2 0 0,1 12,14A2,2 0 0,1 10,12A2,2 0 0,1 12,10M12,4A2,2 0 0,1 14,6A2,2 0 0,1 12,8A2,2 0 0,1 10,6A2,2 0 0,1 12,4Z");
    buttons.appendChild(path);
    buttons.style.height = "30px"
    buttons.style.marginTop = "5px"
    buttons.style.justifySelf = "flex-end"
    buttons.addEventListener("click", editButtonClick)

    editOL = document.createElement("ol")

    const editCover = document.createElement("li")
    editCover.textContent = "Change Book Cover"
    editCover.style.cursor = "pointer"
    // editCover.addEventListener("click", editCoverClick)
    editOL.appendChild(editCover)

    const editReview = document.createElement("li")
    editReview.textContent = "Edit your Review"
    editReview.style.cursor = "pointer"
    // editReview.addEventListener("click", editReviewClick)
    editOL.appendChild(editReview)

    const editSynopsis = document.createElement("li")
    editSynopsis.textContent = "Edit Synopsis"
    editSynopsis.style.cursor = "pointer"
    // editSynopsis.addEventListener("click", editSynopsisClick)
    editOL.appendChild(editSynopsis)

    const editRating = document.createElement("li")
    editRating.textContent = "Change your Rating"
    editRating.style.cursor = "pointer"
    // editRating.addEventListener("click", editRatingClick)
    editOL.appendChild(editRating)
    editOL.classList.add("edit")

    dotsDiv.appendChild(buttons)
    dotsDiv.appendChild(editOL)
    details.appendChild(dotsDiv);
    
    main.appendChild(book)
    addDarkClass()

}

function displayCompactBooks(currBook) {
  const main = document.querySelector(".main")

  const book = document.createElement("div")
  book.classList.add("book")

  const cover = document.createElement("div")
  cover.classList.add("book-cover")
  cover.style.backgroundImage = `url(${currBook.cover})`
  cover.style.backgroundSize = "cover"
  cover.style.backgroundPosition = "center"
  cover.addEventListener("mouseenter", bookCoverHover); 
  cover.addEventListener("mouseleave", bookCoverMouseOut); 
  cover.addEventListener("click", bookCoverClick); 

  const deleteButton = document.createElement("button");
  deleteButton.classList.add("deleteButton");

  const svg = document.createElementNS("http://www.w3.org/2000/svg", "svg");
  svg.setAttribute("viewBox", "0 0 15 17.5");
  svg.setAttribute("height", "17.5");
  svg.setAttribute("width", "15");
  svg.setAttribute("xmlns", "http://www.w3.org/2000/svg");
  svg.classList.add("icon");

  const iconPath = document.createElementNS("http://www.w3.org/2000/svg", "path");
  iconPath.setAttribute("transform", "translate(-2.5 -1.25)");
  iconPath.setAttribute("d", "M15,18.75H5A1.251,1.251,0,0,1,3.75,17.5V5H2.5V3.75h15V5H16.25V17.5A1.251,1.251,0,0,1,15,18.75ZM5,5V17.5H15V5Zm7.5,10H11.25V7.5H12.5V15ZM8.75,15H7.5V7.5H8.75V15ZM12.5,2.5h-5V1.25h5V2.5Z");
  iconPath.setAttribute("id", "Fill");

  svg.appendChild(iconPath);
  deleteButton.appendChild(svg);
  cover.appendChild(deleteButton);
  deleteButton.addEventListener("click", deleteButtonClick)

  const likeLabel = document.createElement("label");
  likeLabel.classList.add("like");
  
  const likeInput = document.createElement("input");
  likeInput.type = "checkbox";
  likeInput.addEventListener("click", likeClicked)
  
  const likeSvg = document.createElementNS("http://www.w3.org/2000/svg", "svg");
  likeSvg.setAttribute("id", "Layer_1");
  likeSvg.setAttribute("version", "1.0");
  likeSvg.setAttribute("viewBox", "0 0 24 24");
  likeSvg.setAttribute("xml:space", "preserve");
  likeSvg.setAttribute("xmlns", "http://www.w3.org/2000/svg");
  likeSvg.setAttribute("xmlns:xlink", "http://www.w3.org/1999/xlink");
  
  const likePath = document.createElementNS("http://www.w3.org/2000/svg", "path");
  likePath.setAttribute("d", "M16.4,4C14.6,4,13,4.9,12,6.3C11,4.9,9.4,4,7.6,4C4.5,4,2,6.5,2,9.6C2,14,12,22,12,22s10-8,10-12.4C22,6.5,19.5,4,16.4,4z");
  
  likeSvg.appendChild(likePath);
  likeLabel.appendChild(likeInput);
  likeLabel.appendChild(likeSvg);
  cover.appendChild(likeLabel);

  if (currBook.favorite == 'true') {likeSvg.style.fill = "#E3474F"}

  book.appendChild(cover)

  const details = document.createElement("div")
  details.classList.add("book-details")
  book.appendChild(details)

  const title_author = document.createElement("div")

  const title = document.createElement("p")
  title.addEventListener("click", editTitle)
  title.textContent = currBook.title
  title_author.appendChild(title)

  const author = document.createElement("p")
  author.textContent = currBook.author
  author.style.color = "gray"
  author.addEventListener("click", editAuthor)
  title_author.appendChild(author)

    

  const length = document.createElement("div")
  const lengthValue = document.createElement("span")
  lengthValue.textContent = currBook.length
  lengthValue.addEventListener("click", editLength)
  length.appendChild(lengthValue)
  const lengthType = document.createElement("span")
  lengthType.textContent = " "+currBook.lengthType
  lengthType.addEventListener("click", editLengthType)
  length.appendChild(lengthType)
  title_author.appendChild(length)

  const status = document.createElement("p")
  if (currBook.status === "Unread") {
      status.textContent = "Unread"
      status.style.color = "red"
  }
  else if (currBook.status === "Started") {
      status.textContent = "Started"
      status.style.color = "blue"
  }
  else {
      status.textContent = "Completed"
      status.style.color = "green"
  }

  status.addEventListener("click", statusChange)


  title_author.appendChild(status)

  details.appendChild(title_author)

  
  const dotsDiv = document.createElement("div")
  dotsDiv.classList.add("dotsDiv")
  
  const buttons = document.createElementNS("http://www.w3.org/2000/svg", "svg");
  buttons.classList.add("three-vertical-dots");
  buttons.style.cursor = "pointer";
  buttons.setAttribute("xmlns", "http://www.w3.org/2000/svg");
  buttons.setAttribute("viewBox", "0 0 24 24");
  const titleElement = document.createElementNS("http://www.w3.org/2000/svg", "title");
  titleElement.textContent = "dots-vertical";
  buttons.appendChild(titleElement);

  const path = document.createElementNS("http://www.w3.org/2000/svg", "path");
  path.setAttribute("d", "M12,16A2,2 0 0,1 14,18A2,2 0 0,1 12,20A2,2 0 0,1 10,18A2,2 0 0,1 12,16M12,10A2,2 0 0,1 14,12A2,2 0 0,1 12,14A2,2 0 0,1 10,12A2,2 0 0,1 12,10M12,4A2,2 0 0,1 14,6A2,2 0 0,1 12,8A2,2 0 0,1 10,6A2,2 0 0,1 12,4Z");
  buttons.appendChild(path);
  buttons.style.height = "30px"
  buttons.style.marginTop = "5px"
  buttons.style.justifySelf = "flex-end"
  buttons.addEventListener("click", editButtonClick)

  editOL = document.createElement("ol")

  const editCover = document.createElement("li")
  editCover.textContent = "Change Book Cover"
  editCover.style.cursor = "pointer"
  // editCover.addEventListener("click", editCoverClick)
  editOL.appendChild(editCover)

  const editReview = document.createElement("li")
  editReview.textContent = "Edit your Review"
  editReview.style.cursor = "pointer"
  // editReview.addEventListener("click", editReviewClick)
  editOL.appendChild(editReview)

  const editSynopsis = document.createElement("li")
  editSynopsis.textContent = "Edit Synopsis"
  editSynopsis.style.cursor = "pointer"
  // editSynopsis.addEventListener("click", editSynopsisClick)
  editOL.appendChild(editSynopsis)

  const editRating = document.createElement("li")
  editRating.textContent = "Change your Rating"
  editRating.style.cursor = "pointer"
  // editRating.addEventListener("click", editRatingClick)
  editOL.appendChild(editRating)
  editOL.classList.add("edit")

  editOL.style.fontSize = "12px"

  dotsDiv.appendChild(buttons)
  dotsDiv.appendChild(editOL)
  details.appendChild(dotsDiv);
  
  
  main.appendChild(book)
  addDarkClass()
}

function listView(currBook) {
  newmain = document.querySelector(".main")
  book = document.createElement("div")
  book.classList.add("book")
  book.style.display = "flex"; // Use flexbox for layout
  book.style.alignItems = "center"; // Center items vertically
  book.style.width = "100%"; // Full width

  cover = document.createElement("div")
  cover.classList.add("book-cover")
  cover.style.height = "100px"; // Maintain aspect ratio
  cover.style.aspectRatio = "2/3"
  cover.style.backgroundImage = `url(${currBook.cover})`
  cover.style.backgroundSize = "cover"
  cover.style.backgroundPosition = "center"
  cover.style.marginRight = "10px"; // Space between cover and details

  const likeBtn = document.createElement("label")
  likeBtn.classList.add("like")
  likeBtn.innerHTML = `<input type="checkbox"><svg id="Layer_1" version="1.0" viewBox="0 0 24 24" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M16.4,4C14.6,4,13,4.9,12,6.3C11,4.9,9.4,4,7.6,4C4.5,4,2,6.5,2,9.6C2,14,12,22,12,22s10-8,10-12.4C22,6.5,19.5,4,16.4,4z"></path></svg>`
  likeBtn.style.height = "20px"

  if (currBook.favorite) {
    likeBtn.classList.add("liked"); // Add a class to indicate it's liked
  }
  likeBtn.addEventListener("click", () => {
    currBook.favorite = !currBook.favorite;
    likeBtn.classList.toggle("liked");
  });

  likeBtn.addEventListener("click", likeClicked)
  cover.appendChild(likeBtn)

  const deleteButton = document.createElement("button");
  deleteButton.classList.add("deleteButton");
  deleteButton.innerHTML = `
    <svg viewBox="0 0 15 17.5" height="17.5" width="15" xmlns="http://www.w3.org/2000/svg" class="icon">
      <path transform="translate(-2.5 -1.25)" d="M15,18.75H5A1.251,1.251,0,0,1,3.75,17.5V5H2.5V3.75h15V5H16.25V17.5A1.251,1.251,0,0,1,15,18.75ZM5,5V17.5H15V5Zm7.5,10H11.25V7.5H12.5V15ZM8.75,15H7.5V7.5H8.75V15ZM12.5,2.5h-5V1.25h5V2.5Z" id="Fill"></path>
    </svg>`;
  deleteButton.addEventListener("click", deleteButtonClick);
  deleteButton.style.position = "relative";
  deleteButton.style.left = "70%";
  cover.appendChild(deleteButton);
  

  cover.addEventListener("mouseenter", bookCoverHover);
  cover.addEventListener("mouseleave", bookCoverMouseOut);
  cover.addEventListener("click", bookCoverClick);
  book.appendChild(cover)


  details = document.createElement("div")
  details.classList.add("book-details")
  details.style.flex = "1"; // Occupy remaining space
  details.style.borderRadius = "5px"
  details.style.display = "flex"; // Use flexbox for layout
  details.style.alignItems = "center"; // Center items vertically
  details.style.justifyContent = "space-between"; // Space between items

  const title_author = document.createElement("div")
  title_author.style.display = "flex"; // Use flexbox for layout
  title_author.style.flexDirection = "column"; // Stack items vertically
  title_author.style.flex = "1"; // Occupy remaining space

  const title = document.createElement("p")
  title.textContent = currBook.title
  title.style.fontSize = "18px"
  title.style.margin = "0"
  title.style.cursor = "pointer"
  title.addEventListener("click", editTitle)
  title_author.appendChild(title)

  const author = document.createElement("p")
  author.textContent = currBook.author
  author.style.color = "gray"
  author.style.fontSize = "16px"
  author.style.margin = "0"
  author.style.cursor = "pointer"
  author.addEventListener("click", editAuthor)

  title_author.appendChild(author)

  const length = document.createElement("div")
  length.style.display = "flex"; // Use flexbox for layout
  length.style.alignItems = "center"; // Center items vertically
  length.style.fontSize = "14px"
  length.style.margin = "0"

  const lengthValue = document.createElement("span")
  lengthValue.textContent = currBook.length
  lengthValue.style.cursor = "pointer"
  lengthValue.addEventListener("click", editLength)
  length.appendChild(lengthValue)

  const lengthType = document.createElement("span")
  lengthType.textContent = " " + currBook.lengthType
  lengthType.style.cursor = "pointer"
  lengthType.addEventListener("click", editLengthType)
  length.appendChild(lengthType)

  title_author.appendChild(length)

  const status = document.createElement("p")
  status.style.fontSize = "14px"
  status.style.margin = "0"
  if (currBook.status === "Unread") {
      status.textContent = "Unread"
      status.style.color = "red"
  }
  else if (currBook.status === "Started") {
      status.textContent = "Started"
      status.style.color = "blue"
  }
  else {
      status.textContent = "Completed"
      status.style.color = "green"
  }

  status.style.cursor = "pointer"
  status.addEventListener("click", statusChange)

  title_author.appendChild(status)

  details.appendChild(title_author)

  
  const dotsDiv = document.createElement("div")
  dotsDiv.classList.add("dotsDiv")
  
  const buttons = document.createElementNS("http://www.w3.org/2000/svg", "svg");
  buttons.classList.add("three-vertical-dots");
  buttons.style.cursor = "pointer";
  buttons.setAttribute("xmlns", "http://www.w3.org/2000/svg");
  buttons.setAttribute("viewBox", "0 0 24 24");
  const titleElement = document.createElementNS("http://www.w3.org/2000/svg", "title");
  titleElement.textContent = "dots-vertical";
  buttons.appendChild(titleElement);

  const path = document.createElementNS("http://www.w3.org/2000/svg", "path");
  path.setAttribute("d", "M12,16A2,2 0 0,1 14,18A2,2 0 0,1 12,20A2,2 0 0,1 10,18A2,2 0 0,1 12,16M12,10A2,2 0 0,1 14,12A2,2 0 0,1 12,14A2,2 0 0,1 10,12A2,2 0 0,1 12,10M12,4A2,2 0 0,1 14,6A2,2 0 0,1 12,8A2,2 0 0,1 10,6A2,2 0 0,1 12,4Z");
  buttons.appendChild(path);
  buttons.style.height = "30px"
  buttons.style.marginTop = "5px"
  buttons.style.justifySelf = "flex-end"
  buttons.addEventListener("click", editButtonClick)

  editOL = document.createElement("ol")

  const editCover = document.createElement("li")
  editCover.textContent = "Change Book Cover"
  editCover.style.cursor = "pointer"
  // editCover.addEventListener("click", editCoverClick)
  editOL.appendChild(editCover)

  const editReview = document.createElement("li")
  editReview.textContent = "Edit your Review"
  editReview.style.cursor = "pointer"
  // editReview.addEventListener("click", editReviewClick)
  editOL.appendChild(editReview)

  const editSynopsis = document.createElement("li")
  editSynopsis.textContent = "Edit Synopsis"
  editSynopsis.style.cursor = "pointer"
  // editSynopsis.addEventListener("click", editSynopsisClick)
  editOL.appendChild(editSynopsis)

  const editRating = document.createElement("li")
  editRating.textContent = "Change your Rating"
  editRating.style.cursor = "pointer"
  // editRating.addEventListener("click", editRatingClick)
  editOL.appendChild(editRating)
  editOL.classList.add("edit")

  buttons.style.cursor = "pointer"
  buttons.style.height = "20px"
  buttons.style.marginTop = "5px"
  buttons.style.alignSelf = "flex-start"
  buttons.addEventListener("click", editButtonClick)
  
  dotsDiv.appendChild(buttons)
  dotsDiv.appendChild(editOL)
  details.appendChild(dotsDiv);

  book.appendChild(details)
  book.style.height = "100px"
  book.style.marginBottom = "10px"; // Add some space between books
  newmain.appendChild(book)
  addDarkClass()
}


const plusButton = document.querySelector(".plusButton");
const closeButton = document.querySelector(".closeButton");
const dialog = document.querySelector(".dialog");
const main = document.querySelector(".main");

plusButton.addEventListener("click", () => {
  dialog.showModal();
  main.classList.add("dialog-open"); // Add class to resize container
});

closeButton.addEventListener("click", () => {
  dialog.close();
  main.classList.remove("dialog-open"); // Remove class to resize container back
});

const coverDialog = document.querySelector("input#cover");
coverDialog.addEventListener("input", () => {
  const coverDialogValue = document.querySelector(".dialog>div");
  coverDialogValue.style.border = "2px solid black";
  coverDialogValue.style.backgroundImage = `url(${coverDialog.value})`;
  coverDialogValue.style.backgroundSize = "cover";
  coverDialogValue.style.backgroundPosition = "center";
  coverDialogValue.style.width = "100%";
  coverDialogValue.style.aspectRatio = "2 / 2.75";
  coverDialogValue.style.marginBottom = "5px";
});

confirmBtn.addEventListener("click", (event) => {
  event.preventDefault(); // We don't want to submit this fake form
  let coverDialogValue = document.querySelector(".dialog>div");
  let titleDialog = document.querySelector("input#title").value;
  let authorDialog = document.querySelector("input#author").value;
  let lengthDialog = document.querySelector("#length").value;
  let lengthTypeDialog = document.querySelector('input[name="length"]:checked').value;
  let readStatusDialog = document.querySelector("select").value;
  let synopsisDialog = document.querySelector("#synopsis").value
  if (synopsisDialog == "Write a summary...") {synopsisDialog = ""}
  let favoriteDialog = document.querySelector(".like input[type='checkbox']").checked.toString()
  let reviewDialog = document.querySelector("#review").value
  if (reviewDialog == "Write a Review...") {reviewDialog = ""}
  let ratingDialog = document.querySelector("#rating").value
  if (ratingDialog == "default") {ratingDialog = ""}
  let newBookName = titleDialog;
  main.innerHTML = "";
  newBookName= new Book(titleDialog, authorDialog, readStatusDialog, lengthDialog, lengthTypeDialog, coverDialog.value, synopsisDialog, favoriteDialog, reviewDialog, ratingDialog);
  myLibrary.push(newBookName);
  myLibrary.forEach(book => {if (viewType == "regular") {displayBooks(book)} else if (viewType == "compact") {displayCompactBooks(book)} else if (viewType == "list") {listView(book)}})
  dialog.close(); // Have to send the select box value here.
  main.classList.remove("dialog-open"); // Remove class to resize container back
  document.querySelector("form").reset(); // Reset the form
  coverDialogValue.style.border = "none";
  coverDialogValue.style.backgroundImage = "none";
  coverDialogValue.style.width = "0%";
  coverDialogValue.style.aspectRatio = "0";
  coverDialogValue.style.marginBottom = "0";
});

function editButtonClick(event) {
  const bookWhoseEditButtonWasClicked = event.target.closest(".book");
  const editList = bookWhoseEditButtonWasClicked.querySelector(".edit");
  editList.style.width = "mincontent";
  editList.style.position = "absolute";
  editList.style.top = "25%";
  editList.style.left = "-300%";
  if(viewType == "compact" || viewType == "list") {editList.style.left = "-800%"}
  if (editList.style.display == "block") {editList.style.display = "none"}
  else if (editList.style.display == "none" || editList.style.display == "") {editList.style.display = "block"}
  editList.addEventListener("click", (event) => {
    if (event.target.textContent == "Change Book Cover") {changeCover(event)}
    else if (event.target.textContent == "Edit your Review") {editReview(event)}
    else if (event.target.textContent == "Edit Synopsis") {editSynopsis(event)}
    else if (event.target.textContent == "Change your Rating") {changeRating(event)}
  })
  editList.addEventListener("mouseenter", (event) => {editList.style.display = "block"})
  editList.addEventListener("mouseleave", (event) => {editList.style.display = "none"})
}

function changeCover(event) {
  book = event.target.closest(".book")
  bookTitle = book.querySelector(".book-details > div > p:nth-child(1)").textContent
  book = myLibrary.find(book => book.title === bookTitle)
  const changeCover = document.querySelector(".change-book-cover")
  changeCover.showModal();
  changeCover.style.position = "fixed";
  changeCover.style.top = "5%";
  changeCover.style.left = "25%";
  changeCover.style.fontSize = "16px";
  changeCover.style.width = "50vw";
  changeCover.style.display = "flex";
  changeCover.style.flexDirection = "column";
  changeCover.style.gap = "10px";
  coverPreview = document.querySelector(".cover-preview")
  coverPreview.style.height = "100%";
  coverPreview.style.aspectRatio = "2/3";
  coverPreview.style.border = "2px solid black";
  coverPreview.style.backgroundSize = "cover";
  coverPreview.style.backgroundPosition = "center";
  coverURL = document.querySelector("#coverURL")
  coverURL.addEventListener("input", () => {coverPreview.style.backgroundImage = `url(${coverURL.value})`})
  closeChangeCover = document.querySelector("#closeChangeCover")
  closeChangeCover.addEventListener("click", () => {changeCover.close();changeCover.style.display = "none"; main.innerHTML = "";myLibrary.forEach(book => {if (viewType == "regular") {displayBooks(book)} else if (viewType == "compact") {displayCompactBooks(book)} else if (viewType == "list") {listView(book)}; addDarkClass()})})
  confirmChangeCover = document.querySelector("#book-cover-change")
  confirmChangeCover.addEventListener("click", () =>{if (coverURL.value == "") {coverURL.value = book.cover} book.cover = coverURL.value;coverPreview.style.backgroundImage = ""; coverURL.value = "";changeCover.close();changeCover.style.display = "none"; main.innerHTML = ""; myLibrary.forEach(book => {if (viewType == "regular") {displayBooks(book)} else if (viewType == "compact") {displayCompactBooks(book)} else if (viewType == "list") {listView(book)}; addDarkClass()})})
}

function editReview(event) {
  book = event.target.closest(".book")
  bookTitle = book.querySelector(".book-details > div > p:nth-child(1)").textContent
  book = myLibrary.find(book => book.title === bookTitle)
  changeReview = document.querySelector(".edit-review")
  changeReview.showModal();
  changeReview.style.position = "fixed";
  changeReview.style.top = "5%";
  changeReview.style.left = "25%";
  changeReview.style.fontSize = "16px";
  changeReview.style.width = "50vw";
  changeReview.style.display = "flex";
  changeReview.style.flexDirection = "column";
  changeReview.style.gap = "10px";
  review = document.querySelector("#editReview")
  review.value = book.review
  closeChangeReview = document.querySelector("#closeEditReview")
  closeChangeReview.addEventListener("click", () => {changeReview.close();changeReview.style.display = "none";main.innerHTML = ""; myLibrary.forEach(book => {if (viewType == "regular") {displayBooks(book)} else if (viewType == "compact") {displayCompactBooks(book)} else if (viewType == "list") {listView(book)}; addDarkClass()})})
  confirmChangeReview = document.querySelector("#edit-review-confirm")
  confirmChangeReview.addEventListener("click", () =>{if (review.value == "") {review.value = book.review} book.review = review.value; review.value = ""; changeReview.close();changeReview.style.display = "none";main.innerHTML = ""; myLibrary.forEach(book => {if (viewType == "regular") {displayBooks(book)} else if (viewType == "compact") {displayCompactBooks(book)} else if (viewType == "list") {listView(book)}; addDarkClass()})})
}

function editSynopsis(event) {
  book = event.target.closest(".book")
  bookTitle = book.querySelector(".book-details > div > p:nth-child(1)").textContent
  book = myLibrary.find(book => book.title === bookTitle)
  changeSynopsis = document.querySelector(".edit-synopsis")
  changeSynopsis.showModal();
  changeSynopsis.style.position = "fixed";
  changeSynopsis.style.top = "5%";
  changeSynopsis.style.left = "25%";
  changeSynopsis.style.fontSize = "16px";
  changeSynopsis.style.width = "50vw";
  changeSynopsis.style.display = "flex";
  changeSynopsis.style.flexDirection = "column";
  changeSynopsis.style.gap = "10px";
  synopsis = document.querySelector("#editSynopsis")
  synopsis.value = book.synopsis
  closeChangeSynopsis = document.querySelector("#closeEditSynopsis")
  closeChangeSynopsis.addEventListener("click", () => {changeSynopsis.close();changeSynopsis.style.display = "none";main.innerHTML = ""; myLibrary.forEach(book => {if (viewType == "regular") {displayBooks(book)} else if (viewType == "compact") {displayCompactBooks(book)} else if (viewType == "list") {listView(book)}; addDarkClass()})})
  confirmChangeSynopsis = document.querySelector("#edit-synopsis-confirm")
  confirmChangeSynopsis.addEventListener("click", () =>{if (synopsis.value == "") {synopsis.value = book.synopsis}book.synopsis = synopsis.value; synopsis.value = ""; changeSynopsis.close();changeSynopsis.style.display = "none";main.innerHTML = ""; myLibrary.forEach(book => {if (viewType == "regular") {displayBooks(book)} else if (viewType == "compact") {displayCompactBooks(book)} else if (viewType == "list") {listView(book)}; addDarkClass()})})
}

// Set up the dialog and listeners only once
const changeRatingDialog = document.querySelector(".change-rating");
const closeChangeRating = document.querySelector("#closeChangeRating");
const confirmChangeRating = document.querySelector("#change-rating-confirm");
const ratingInput = document.querySelector("#editRating");
const star = document.querySelector("#star");

// Add event listeners only once during the initial setup
closeChangeRating.addEventListener("click", () => {
  changeRatingDialog.close();
  changeRatingDialog.style.display = "none";
  main.innerHTML = "";
  myLibrary.forEach((book) => {
    if (viewType == "regular") {
      displayBooks(book);
    } else if (viewType == "compact") {
      displayCompactBooks(book);
    } else if (viewType == "list") {
      listView(book);
    }
    addDarkClass();
  });
});

confirmChangeRating.addEventListener("click", () => {
  const bookTitle = changeRatingDialog.dataset.bookTitle;
  const book = myLibrary.find((b) => b.title === bookTitle);

  if (!ratingInput.value) {
    ratingInput.value = book.rating;
  }
  book.rating = ratingInput.value;
  ratingInput.value = "";
  changeRatingDialog.close();
  changeRatingDialog.style.display = "none";
  main.innerHTML = "";
  myLibrary.forEach((book) => {
    if (viewType == "regular") {
      displayBooks(book);
    } else if (viewType == "compact") {
      displayCompactBooks(book);
    } else if (viewType == "list") {
      listView(book);
    }
    addDarkClass();
  });
});

// Main function to open and configure the dialog
function changeRating(event) {
  const bookElement = event.target.closest(".book");
  const bookTitle = bookElement.querySelector(".book-details > div > p:nth-child(1)").textContent;
  const book = myLibrary.find((b) => b.title === bookTitle);

  // Pass the book's title to the dialog using a data attribute
  changeRatingDialog.dataset.bookTitle = bookTitle;

  changeRatingDialog.showModal();
  changeRatingDialog.style.position = "fixed";
  changeRatingDialog.style.top = "5%";
  changeRatingDialog.style.left = "25%";
  changeRatingDialog.style.fontSize = "16px";
  changeRatingDialog.style.width = "50vw";
  changeRatingDialog.style.display = "flex";
  changeRatingDialog.style.flexDirection = "column";
  changeRatingDialog.style.gap = "10px";

  ratingInput.value = book.rating;
  star.style.fill = "gold";
  star.style.width = "20px";
  star.style.height = "20px";
}


function bookCoverHover(event) {
  const cover = event.target.closest(".book-cover");
  const book = myLibrary.find(book => book.title === cover.closest(".book").querySelector(".book-details > div > p:nth-child(1)").textContent);
  const overlay = document.createElement("div");
  overlay.classList.add("synopsis")
  overlay.textContent = book.synopsis;
  if(book.synopsis === undefined) {
    overlay.textContent = "Add synopsis";
  }

  // Style the overlay
  overlay.style.height = "100%";
  cover.style.position = "relative";
  overlay.style.position = "absolute";
  overlay.style.top = "0";
  overlay.style.backdropFilter = "blur(2px)";
  overlay.style.padding = "5px";
  overlay.style.width = "100%";
  overlay.style.textShadow = "2px 2px black";


  // Parent height and truncation logic
  const parentHeight = cover.offsetHeight;
  overlay.style.fontSize = "14px"; // Font size
  overlay.style.lineHeight = "24px"; // Line height for consistent row spacing
  overlay.style.maxHeight = `${parentHeight}px`; // Cap the height to parent's height
  overlay.style.overflow = "hidden"; // Hides overflowing content
  overlay.style.whiteSpace = "normal"; // Allows multi-line wrapping
  overlay.style.display = "block"; // Ensure it's a block element
  overlay.style.color = "white";
  overlay.style.wordBreak = "break-word"; // Prevent words from breaking layout

  // Calculate and truncate based on lines
  const maxLines = Math.floor(parentHeight / 24); // Number of lines based on parent height
  overlay.style.display = "-webkit-box"; // Multi-line truncation
  overlay.style.webkitBoxOrient = "vertical";
  overlay.style.webkitLineClamp = maxLines; // Limit to calculated lines

  // Add the overlay to the book cover
  cover.appendChild(overlay);
}


function bookCoverMouseOut(event) {
  const cover = event.target.closest(".book-cover");
  const overlay = cover.querySelector(".synopsis");
  if (overlay) {
    overlay.remove();
  }
}

function deleteButtonClick(event) {
  const parentElement = event.target.closest(".book"); 
  const bookToDelete = parentElement.querySelector(".book-details > div > p:nth-child(1)").textContent;
  parentElement.remove();
  myLibrary = myLibrary.filter(book => book.title !== bookToDelete);
}

function editAuthor(event) {
  const authorSelector = event.target.closest(".book-details");
  const authorElement = authorSelector.querySelector("div>p:nth-child(2)");
  const currentAuthor = authorElement.textContent;
  const book = myLibrary.find(book => book.author === currentAuthor);

  // Create a textarea element for editing the author
  const textarea = document.createElement("textarea");
  textarea.value = currentAuthor;
  textarea.style.width = "100%";
  textarea.style.height = "auto";

  // Replace the author element with the textarea
  authorElement.replaceWith(textarea);

  // Focus the textarea and select the text
  textarea.focus();
  textarea.select();

  // Handle the blur event to save the new author
  textarea.addEventListener("blur", () => {
    const newAuthor = textarea.value.trim();
    if (newAuthor) {
      book.author = newAuthor;
      const newAuthorElement = document.createElement("p");
      newAuthorElement.textContent = newAuthor;
      newAuthorElement.style.wordBreak = "break-word";
      textarea.replaceWith(newAuthorElement)
      newAuthorElement.addEventListener("click", editAuthor);
      newAuthorElement.style.color = "gray";
      if (viewType == "compact") {authorElement.style.font = "gray"}
      else {newAuthorElement.style.fontSize = "16px";}
    } else {
      // If the new author is empty, revert to the original author
      textarea.replaceWith(authorElement)
      if (viewType == "compact") {authorElement.style.font = "gray"}
      authorElement.addEventListener("click", editAuthor);
    }
  });
}

function editTitle(event) {
  const titleSelector = event.target.closest(".book-details");
  const titleElement = titleSelector.querySelector("div>p:nth-child(1)");
  const currentTitle = titleElement.textContent;
  const book = myLibrary.find(book => book.title === currentTitle);

  // Create a textarea element for editing the title
  const textarea = document.createElement("textarea");
  textarea.value = currentTitle;
  textarea.style.width = "100%";
  textarea.style.height = "auto";

  // Replace the title element with the textarea
  titleElement.replaceWith(textarea);

  // Focus the textarea and select the text
  textarea.focus();
  textarea.select();

  // Handle the blur event to save the new title
  textarea.addEventListener("blur", () => {
    const newTitle = textarea.value.trim();
    if (newTitle) {
      book.title = newTitle;
      const newTitleElement = document.createElement("p");
      newTitleElement.textContent = newTitle;
      newTitleElement.style.wordBreak = "break-word";
      textarea.replaceWith(newTitleElement)
      newTitleElement.addEventListener("click", editTitle);
      if (viewType == "compact") {newTitleElement.style.fontSize = "10px"}
      else {newTitleElement.style.fontSize = "18px";}
    } else {
      // If the new title is empty, revert to the original title
      textarea.replaceWith(titleElement)
      if (viewType == "compact") {titleElement.style.font = "gray"}
      else {titleElement.style.fontSize = "18px";}
      titleElement.addEventListener("click", editTitle);
    }
  });
}

function editLength(event) {
  const lengthSelector = event.target.closest(".book-details");
  const lengthElement = lengthSelector.querySelector("div > div > span:nth-child(1)");
  const currentLength = lengthElement.textContent;
  const book = myLibrary.find(book => book.length == currentLength);
  // Create a textarea element for editing the length
  const textarea = document.createElement("textarea");
  textarea.value = currentLength;
  textarea.style.width = "100%";
  textarea.style.height = "auto";
  textarea.style.boxSizing = "border-box";
  textarea.setAttribute("pattern", "[0-9]*"); // Enforce numeric input

  // Replace the length element with the textarea
  lengthElement.replaceWith(textarea);

  // Focus the textarea and select the text
  textarea.focus();
  textarea.select();

  // Handle the input event to restrict to numeric input
  textarea.addEventListener("input", () => {
    textarea.value = textarea.value.replace(/[^0-9]/g, ''); // Remove non-numeric characters
  });

  // Handle the blur event to save the new length
  textarea.addEventListener("blur", () => {
    const newLength = textarea.value.trim();
    if (newLength) {
      book.length = newLength;
      const newLengthElement = document.createElement("span");
      newLengthElement.textContent = newLength;
      newLengthElement.style.wordBreak = "break-word";
      newLengthElement.style.width = "min-content"
      newLengthElement.addEventListener("click", editLength); // Reattach the click event listener
      textarea.replaceWith(newLengthElement);
      if (viewType == "compact") {newLengthElement.style.fontSize = "10px"}
      else {newLengthElement.style.fontSize = "14px";}
    } else {
      // If the new length is empty, revert to the original length
      textarea.replaceWith(lengthElement);
      if (viewType == "compact") {lengthElement.style.fontSize = "10px"}
      else {lengthElement.style.fontSize = "14px";}
      lengthElement.addEventListener("click", editLength);
    }
  });
}

function editLengthType(event) {
  const lengthTypeSelector = event.target.closest(".book-details");
  const lengthTypeElement = lengthTypeSelector.querySelector("div > div > span:nth-child(2)");
  const currentLengthType = lengthTypeElement.textContent.trim();
  const book = myLibrary.find(book => book.lengthType === currentLengthType);

  // Create a select element for editing the length type
  const select = document.createElement("select");
  select.style.width = "100%";
  select.style.height = "auto";

  // Create the options for the select element
  const options = ["Pages", "Chapters"];
  options.forEach(option => {
    const optionElement = document.createElement("option");
    optionElement.value = option;
    optionElement.textContent = option;
    select.appendChild(optionElement);
  });

  // Set the selected option based on the current length type
  select.value = currentLengthType;

  // Replace the length type element with the select element
  lengthTypeElement.replaceWith(select);

  // Handle the blur event to save the new length type
  select.addEventListener("blur", () => {
    const newLengthType = select.value;
    if (newLengthType) {
      book.lengthType = newLengthType;
      const newLengthTypeElement = document.createElement("span");
      newLengthTypeElement.textContent = " " + newLengthType;
      newLengthTypeElement.style.wordBreak = "break-word";
      newLengthTypeElement.addEventListener("click", editLengthType); // Reattach the click event listener
      select.replaceWith(newLengthTypeElement);
      if (viewType == "compact") {newLengthTypeElement.style.fontSize = "10px"}
      else {newLengthTypeElement.style.fontSize = "14px";}
    } else {
      // If the new length type is empty, revert to the original length type
      select.replaceWith(lengthTypeElement);
      if (viewType == "compact") {lengthTypeElement.style.fontSize = "10px"}
      else {lengthTypeElement.style.fontSize = "14px";}
      lengthTypeElement.addEventListener("click", editLengthType);
    }
  });
}

function statusChange(event) {
  statusSelector = event.target.closest(".book-details")
  const statusToChange = statusSelector.querySelector("div>p:nth-child(1)").textContent;
  const book = myLibrary.find(book => book.title === statusToChange);
  statusSelector = statusSelector.querySelector("div")
  
  if (event.target.textContent === "Unread") {
    event.target.textContent = "Started";
    event.target.style.color = "blue";
  }
  else if (event.target.textContent === "Started") {
    event.target.textContent = "Completed";
    event.target.style.color = "green";
  }
  else {
    event.target.textContent = "Unread";
    event.target.style.color = "red";
  }

  book.status = event.target.textContent;
  if (viewType == "compact") {event.target.style.fontSize = "10px"}
  else {event.target.style.fontSize = "14px";}
  statusSelector.appendChild(event.target);


}

function likeClicked(event) {
  const bookLiked = event.target.closest(".book")
  const likeToChange = bookLiked.querySelector("div>p:nth-child(1)").textContent;
  const likeButton = bookLiked.querySelector(".like > svg")
  const book = myLibrary.find(book => book.title === likeToChange);
  if (book.favorite == "") {
    book.favorite = 'true'
    likeButton.style.fill = "#E3474F"
  }
  else {
    book.favorite = ""
    likeButton.style.fill = "#666"
  }
}

function bookCoverClick(event) {
  if (event.target.closest('.deleteButton') || event.target.closest('.like')) {
    return; // Exit the function if the like or delete buttons are clicked
  }
  bookInfoDialog = document.querySelector(".bookInfo")
  bookInfo = event.target.closest(".book")
  bookInfoTitle = bookInfo.querySelector(".book-details > div > p:nth-child(1)").textContent
  const book = myLibrary.find(book => book.title === bookInfoTitle);
  bookInfoDialog.style.fontSize = "12px"
  bookInfoDialog.style.display = "grid"
  bookInfoDialog.style.gridTemplateColumns = "1fr 2fr"
  bookInfoDialog.style.gridTemplateRows = "1fr 2fr"
  bookInfoDialog.style.gridGap = "10px"
  bookInfoDialogCover = document.querySelector(".dialog-cover")
  bookInfoDialogCover.style.backgroundImage = `url(${book.cover})`
  bookInfoDialogCover.style.height = "100%"
  bookInfoDialogCover.style.aspectRatio = "2/3"
  bookInfoDialogCover.style.backgroundSize = "cover"
  bookInfoDialogCover.style.gridRow = "1 / 2"
  bookInfoDialogCover.style.gridColumn = "1 / 2"
  bookInfoDialog.appendChild(bookInfoDialogCover)

  bookInfoDialogDetails = document.querySelector(".dialog-info")
  bookInfoDialogDetails.style.display = "flex"
  bookInfoDialogDetails.style.flexDirection = "column"
  bookInfoTitleDialog = document.querySelector(".dialog-title")
  bookInfoTitleDialog.textContent = book.title
  bookInfoTitleDialog.style.fontSize = "20px"
  bookInfoDialogDetails.appendChild(bookInfoTitleDialog)
  bookInfoAuthorDialog = document.querySelector(".dialog-author")
  bookInfoAuthorDialog.textContent = book.author
  bookInfoAuthorDialog.style.color = "gray"
  bookInfoAuthorDialog.style.fontSize = "16px"
  bookInfoDialogDetails.appendChild(bookInfoAuthorDialog)
  bookInfoLengthDialog = document.querySelector(".dialog-length")
  bookInfoLengthDialog.textContent = book.length + " " + book.lengthType
  bookInfoDialogDetails.appendChild(bookInfoLengthDialog)
  bookInfoStatusDialog = document.querySelector(".dialog-status")
  bookInfoStatusDialog.textContent = book.status
  bookInfoDialogDetails.appendChild(bookInfoStatusDialog)
  const bookInfoRatingContainer = document.querySelector(".dialog-rating-container");
  bookInfoRatingContainer.style.display = "flex";
  bookInfoRatingContainer.style.alignItems = "center";
  const bookInfoRatingDialog = document.querySelector(".dialog-rating");
  if (book.rating === "") {bookInfoRatingDialog.textContent = "-/10"}
  else {bookInfoRatingDialog.textContent = book.rating + "/10"}
  bookInfoRatingDialog.style.marginRight = "5px";
  const svg = document.querySelector(".dialog-rating-container > svg");
  svg.style.fill = "gold";
  svg.style.height = "14px";
  bookInfoRatingContainer.appendChild(bookInfoRatingDialog);
  bookInfoRatingContainer.appendChild(svg);
  bookInfoDialogDetails.appendChild(bookInfoRatingContainer);

  const bookInfoFavoriteContainer = document.querySelector(".dialog-favorite-container");
  bookInfoFavoriteContainer.style.display = "flex";
  bookInfoFavoriteContainer.style.alignItems = "center";

  // Clear the container before appending new elements
  bookInfoFavoriteContainer.innerHTML = '';

  if (book.favorite === 'true') {
    const bookInfoFavoriteDialog = document.createElement("label");
    bookInfoFavoriteDialog.className = "dialog-favorite";
    bookInfoFavoriteDialog.textContent = "Remove from Favorites";
    bookInfoFavoriteContainer.appendChild(bookInfoFavoriteDialog);

    const dialogFavoriteSvg = document.createElementNS("http://www.w3.org/2000/svg", "svg");
    dialogFavoriteSvg.setAttribute("viewBox", "0 0 24 24");
    dialogFavoriteSvg.style.fill = "#E3474F";
    dialogFavoriteSvg.style.height = "18px";
    dialogFavoriteSvg.style.marginLeft = "5px";
    dialogFavoriteSvg.innerHTML = '<path d="M16.4,4C14.6,4,13,4.9,12,6.3C11,4.9,9.4,4,7.6,4C4.5,4,2,6.5,2,9.6C2,14,12,22,12,22s10-8,10-12.4C22,6.5,19.5,4,16.4,4z"></path>';
    dialogFavoriteSvg.addEventListener("click", dialogLikeClicked);
    bookInfoFavoriteContainer.appendChild(dialogFavoriteSvg);
  } else if (book.favorite === '') {
    const bookInfoFavoriteDialog = document.createElement("label");
    bookInfoFavoriteDialog.className = "dialog-favorite";
    bookInfoFavoriteDialog.textContent = "Add to Favorites";
    bookInfoFavoriteContainer.appendChild(bookInfoFavoriteDialog);

    const dialogFavoriteSvg = document.createElementNS("http://www.w3.org/2000/svg", "svg");
    dialogFavoriteSvg.setAttribute("viewBox", "0 0 24 24");
    dialogFavoriteSvg.style.fill = "#666";
    dialogFavoriteSvg.style.height = "18px";
    dialogFavoriteSvg.style.marginLeft = "5px";
    dialogFavoriteSvg.innerHTML = '<path d="M16.4,4C14.6,4,13,4.9,12,6.3C11,4.9,9.4,4,7.6,4C4.5,4,2,6.5,2,9.6C2,14,12,22,12,22s10-8,10-12.4C22,6.5,19.5,4,16.4,4z"></path>';
    dialogFavoriteSvg.addEventListener("click", dialogLikeClicked);
    bookInfoFavoriteContainer.appendChild(dialogFavoriteSvg);

  }

  bookInfoDialogDetails.appendChild(bookInfoFavoriteContainer);

  
  const dialogSynopsisAndReviewContainer = document.querySelector(".synopsis-and-review")
  dialogSynopsisAndReviewContainer.style.gridColumn = "span 2"
  dialogSynopsisAndReviewContainer.style.display = "flex"
  dialogSynopsisAndReviewContainer.style.flexDirection = "column"
  const bookInfoSynopsis = document.querySelector(".dialog-synopsis")
  if (book.synopsis === "") {bookInfoSynopsis.innerHTML = "<span style='color: gray; font-Size: 16px'>Synopsis</span><br>Add a synopsis"}
  else {bookInfoSynopsis.innerHTML = "<span style='color: gray; font-Size: 16px'>Synopsis</span><br>" + book.synopsis}
  dialogSynopsisAndReviewContainer.appendChild(bookInfoSynopsis)
  const bookInfoReview = document.querySelector(".dialog-review")
  if (book.review === "") {bookInfoReview.innerHTML = "<span style='color: gray; font-Size: 16px'>Review</span><br>Add a review"}
  else {bookInfoReview.innerHTML = "<span style='color: gray; font-Size: 16px'>Review</span><br>" + book.review}
  dialogSynopsisAndReviewContainer.appendChild(bookInfoReview)
  bookInfoDialog.appendChild(dialogSynopsisAndReviewContainer)

  bookInfoDialog.style.width = "clamp(350px, 50vw, 600px)"
  bookInfoDialog.style.maxHeight = "90vh"
  bookInfoDialog.style.position = "fixed"
  bookInfoDialog.style.top = "50%"
  bookInfoDialog.style.left = "50%"
  bookInfoDialog.style.transform = "translate(-50%, -50%)"
  bookInfoDialog.style.overflow = "auto"; // Enables scrolling
  bookInfoDialog.style.scrollbarWidth = "none"; // Hides scrollbar in Firefox
  bookInfoDialog.style.msOverflowStyle = "none"; // Hides scrollbar in IE/Edge
  bookInfoDialog.style.borderRadius = "5px"

  bookInfoDialog.showModal();

  closeButtonDialog = document.querySelector("#bookInfoDialogcloseButton")
  closeButtonDialog.style.focus = "none"
  closeButtonDialog.style.outline = "none"
  closeButtonDialog.addEventListener("click", () => {bookInfoDialog.close(); bookInfoDialog.style.display = "none"; main.innerHTML = ""; myLibrary.forEach(book => {if (viewType == "regular") {displayBooks(book)} else if (viewType == "compact") {displayCompactBooks(book)} else if (viewType == "list") {listView(book)}})})

}

function dialogLikeClicked(event) {
  const likeStatusChanged = event.target.closest(".dialog-info");
  const likeToChange = likeStatusChanged.querySelector(".dialog-title").textContent;
  const book = myLibrary.find(book => book.title === likeToChange);

  const likeButton = event.target; // The SVG element that was clicked

  if (book.favorite === '') {
    book.favorite = 'true';
    likeButton.style.fill = "#E3474F";
  } else {
    book.favorite = '';
    likeButton.style.fill = "#666";
  }

}
// function bookCoverClick(event) {
//   bookInfoDialog = document.querySelector(".bookInfo")
//   bookInfo = event.target.closest(".book")
//   bookInfoTitle = bookInfo.querySelector(".book-details > div > p:nth-child(1)").textContent
//   const book = myLibrary.find(book => book.title === bookInfoTitle);
//   bookInfoDialog.style.fontSize = "12px"
//   bookInfoDialog.style.display = "grid"
//   bookInfoDialog.style.gridTemplateColumns = "1fr 2fr"
//   bookInfoDialog.style.gridTemplateRows = "1fr 2fr"
//   bookInfoDialog.style.gridGap = "10px"
//   bookInfoDialogCover = document.createElement("div")
//   bookInfoDialogCover.style.gridRow = "span 1"
//   bookInfoDialogCover.style.gridColumn = "span 1"
//   bookInfoDialogCover.style.backgroundImage = `url(${book.cover})`
//   bookInfoDialogCover.style.height = "100%"
//   bookInfoDialogCover.style.aspectRatio = "2/3"
//   bookInfoDialogCover.style.backgroundSize = "cover"
//   bookInfoDialog.appendChild(bookInfoDialogCover)

//   bookInfoDialogDetails = document.createElement("div")
//   bookInfoDialogDetails.style.gridRow = "span 1"
//   bookInfoDialogDetails.style.gridColumn = "span 1"
//   bookInfoDialogDetails.style.display = "flex"
//   bookInfoDialogDetails.style.flexDirection = "column"
//   bookInfoTitleDialog = document.createElement("p")
//   bookInfoTitleDialog.textContent = book.title
//   bookInfoTitleDialog.style.fontSize = "20px"
//   bookInfoDialogDetails.appendChild(bookInfoTitleDialog)
//   bookInfoAuthorDialog = document.createElement("p")
//   bookInfoAuthorDialog.textContent = book.author
//   bookInfoAuthorDialog.style.color = "gray"
//   bookInfoAuthorDialog.style.fontSize = "16px"
//   bookInfoDialogDetails.appendChild(bookInfoAuthorDialog)
//   bookInfoLengthDialog = document.createElement("p")
//   bookInfoLengthDialog.textContent = book.length + " " + book.lengthType
//   bookInfoDialogDetails.appendChild(bookInfoLengthDialog)
//   bookInfoStatusDialog = document.createElement("p")
//   bookInfoStatusDialog.textContent = book.status
//   bookInfoDialogDetails.appendChild(bookInfoStatusDialog)
//   const bookInfoRatingContainer = document.createElement("div");
//   bookInfoRatingContainer.style.display = "flex";
//   bookInfoRatingContainer.style.alignItems = "center";
  
//   const bookInfoRatingDialog = document.createElement("p");
//   bookInfoRatingDialog.textContent = book.rating + "/10";
//   bookInfoRatingDialog.style.marginRight = "5px";
  
//   const svg = document.createElementNS("http://www.w3.org/2000/svg", "svg");
//   svg.setAttribute("height", "24px");
//   svg.setAttribute("id", "Layer_1");
//   svg.setAttribute("version", "1.2");
//   svg.setAttribute("viewBox", "0 0 24 24");
//   svg.setAttribute("width", "24px");
//   svg.setAttribute("xml:space", "preserve");
//   svg.setAttribute("xmlns", "http://www.w3.org/2000/svg");
//   svg.setAttribute("xmlns:xlink", "http://www.w3.org/1999/xlink");
//   svg.style.fill = "gold";
  
//   const g1 = document.createElementNS("http://www.w3.org/2000/svg", "g");
//   const g2 = document.createElementNS("http://www.w3.org/2000/svg", "g");
//   const path = document.createElementNS("http://www.w3.org/2000/svg", "path");
//   path.setAttribute("d", "M9.362,9.158c0,0-3.16,0.35-5.268,0.584c-0.19,0.023-0.358,0.15-0.421,0.343s0,0.394,0.14,0.521    c1.566,1.429,3.919,3.569,3.919,3.569c-0.002,0-0.646,3.113-1.074,5.19c-0.036,0.188,0.032,0.387,0.196,0.506    c0.163,0.119,0.373,0.121,0.538,0.028c1.844-1.048,4.606-2.624,4.606-2.624s2.763,1.576,4.604,2.625    c0.168,0.092,0.378,0.09,0.541-0.029c0.164-0.119,0.232-0.318,0.195-0.505c-0.428-2.078-1.071-5.191-1.071-5.191    s2.353-2.14,3.919-3.566c0.14-0.131,0.202-0.332,0.14-0.524s-0.23-0.319-0.42-0.341c-2.108-0.236-5.269-0.586-5.269-0.586    s-1.31-2.898-2.183-4.83c-0.082-0.173-0.254-0.294-0.456-0.294s-0.375,0.122-0.453,0.294C10.671,6.26,9.362,9.158,9.362,9.158z");
  
//   g2.appendChild(path);
//   g1.appendChild(g2);
//   svg.appendChild(g1);
  
//   bookInfoRatingContainer.appendChild(bookInfoRatingDialog);
//   bookInfoRatingContainer.appendChild(svg);
//   bookInfoDialogDetails.appendChild(bookInfoRatingContainer);
//   bookInfoDialog.appendChild(bookInfoDialogDetails)

//   bookInfoDialogSynopsisAndReview = document.createElement("div")
//   bookInfoDialogSynopsisAndReview.style.gridColumn = "span 2"
//   bookInfoDialogSynopsisAndReview.style.gridRow = "span 1"
//   bookInfoDialogSynopsisAndReview.style.display = "flex"
//   bookInfoDialogSynopsisAndReview.style.flexDirection = "column"
//   bookInfoSynopsisDialog = document.createElement("p")
//   bookInfoSynopsisDialog.innerHTML = "<span style='color: gray; font-Size: 16px'>Synopsis</span><br>" + book.synopsis
//   bookInfoDialogSynopsisAndReview.appendChild(bookInfoSynopsisDialog)
//   bookInfoReviewDialog = document.createElement("p")
//   bookInfoReviewDialog.innerHTML = "<span style='color: gray; font-Size: 16px'>Review</span><br>" + book.review
//   bookInfoDialogSynopsisAndReview.appendChild(bookInfoReviewDialog)
//   bookInfoDialog.style.width = "clamp(350px, 50vw, 600px)"
//   bookInfoDialog.style.maxHeight = "90vh"
//   bookInfoDialog.style.position = "fixed"
//   bookInfoDialog.style.top = "50%"
//   bookInfoDialog.style.left = "50%"
//   bookInfoDialog.style.transform = "translate(-50%, -50%)"
//   bookInfoDialog.style.overflow = "auto"; // Enables scrolling
//   bookInfoDialog.style.scrollbarWidth = "none"; // Hides scrollbar in Firefox
//   bookInfoDialog.style.msOverflowStyle = "none"; // Hides scrollbar in IE/Edge

//   bookInfoDialog.appendChild(bookInfoDialogSynopsisAndReview)
  
//   bookInfoDialog.showModal();

//   closeBookInfo = document.querySelector(".bookInfo > .closeButton")  
//   closeBookInfo.addEventListener("click", () => {
//     bookInfoDialog.close();
//   })


// }

function changeTheme(event) {
  document.body.classList.toggle('dark-theme');
  document.querySelectorAll('.book-details').forEach(element => {element.classList.toggle('dark-theme')});
  document.querySelectorAll('svg').forEach(element => {element.classList.toggle('dark-theme')});
  document.querySelectorAll('svg.icon').forEach(element => {element.classList.toggle('dark-theme')});
  document.querySelectorAll('.list').forEach(element => {element.classList.toggle('dark-theme')});
  document.querySelectorAll('dialog').forEach(element => {element.classList.toggle('dark-theme')});
  document.querySelectorAll('input').forEach(element => {element.classList.toggle('dark-theme')});
  document.querySelectorAll('textarea').forEach(element => {element.classList.toggle('dark-theme')});
  document.querySelectorAll('select').forEach(element => {element.classList.toggle('dark-theme')});
  document.querySelector('#confirmBtn').classList.toggle('dark-theme');
  document.querySelectorAll('.edit').forEach(element => {element.classList.toggle('dark-theme')});
  document.querySelector('.header > div:nth-child(3) > ol:nth-child(5) > div > ol').classList.toggle('dark-theme');

}

function addDarkClass() {
  if (document.querySelector('body').classList.contains("dark-theme")) {
    document.querySelectorAll('.book-details').forEach(element => {element.classList.add('dark-theme')});
    document.querySelectorAll('svg').forEach(element => {element.classList.add('dark-theme')});
    document.querySelectorAll('svg.icon').forEach(element => {element.classList.add('dark-theme')});
    document.querySelectorAll('list').forEach(element => {element.classList.add('dark-theme')});
    document.querySelectorAll('dialog').forEach(element => {element.classList.add('dark-theme')});
    document.querySelectorAll('input').forEach(element => {element.classList.add('dark-theme')});
    document.querySelectorAll('textarea').forEach(element => {element.classList.add('dark-theme')});
    document.querySelectorAll('select').forEach(element => {element.classList.add('dark-theme')});
    document.querySelector('#confirmBtn').classList.add('dark-theme');
    document.querySelectorAll('.edit').forEach(element => {element.classList.add('dark-theme')});
    document.querySelector('.header > div:nth-child(3) > ol:nth-child(5) > div > ol').classList.add('dark-theme');
  }
}

function applyThemeBasedOnSystemPreference() {
  const isDarkMode = window.matchMedia("(prefers-color-scheme: dark)").matches;

  if (isDarkMode) {
    document.querySelector('body').classList.add('dark-theme');
    document.querySelector('.display-list.list').classList.add('dark-theme');
    document.querySelector('ol.list').classList.add('dark-theme');
    document.querySelectorAll('.book-details').forEach(element => {element.classList.add('dark-theme')});
    document.querySelectorAll('svg').forEach(element => {element.classList.add('dark-theme')});
    document.querySelectorAll('svg.icon').forEach(element => {element.classList.add('dark-theme')});
    document.querySelectorAll('list').forEach(element => {element.classList.add('dark-theme')});
    document.querySelectorAll('dialog').forEach(element => {element.classList.add('dark-theme')});
    document.querySelectorAll('input').forEach(element => {element.classList.add('dark-theme')});
    document.querySelectorAll('textarea').forEach(element => {element.classList.add('dark-theme')});
    document.querySelectorAll('select').forEach(element => {element.classList.add('dark-theme')});
    document.querySelector('#confirmBtn').classList.add('dark-theme');
    document.querySelectorAll('.edit').forEach(element => {element.classList.add('dark-theme')});
    document.querySelector('.header > div:nth-child(3) > ol:nth-child(5) > div > ol').classList.add('dark-theme');
  } else {
    return
  }
}

// Apply theme on page load
applyThemeBasedOnSystemPreference();

// Listen for changes in system preference
window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change", applyThemeBasedOnSystemPreference);


 



myLibrary.forEach(book => {if (viewType == "regular") {displayBooks(book)} else if (viewType == "compact") {displayCompactBooks(book)} else if (viewType == "list") {displayBooks(book); listView(book)}})

