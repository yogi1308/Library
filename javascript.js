
// clicking on the dots will enable you to add a genre and a summary, a review, and a rating, and favorite
// add a dark mode
// make the sort button work in ascending and descending order
//clicking on the book cover will open a dialog with all the information about the book
// add feature to make it into compact grid view, list view, and detailed view

Vagabond = new Book('Vagabond', 'Takehiko Inoue', 'Completed', 327, 'Chapters', 'https://d28hgpri8am2if.cloudfront.net/book_images/onix/cvr9781421577449/vagabond-vol-37-9781421577449_hr.jpg', 'Vagabond is a Japanese manga series written and illustrated by Takehiko Inoue. It portrays a fictionalized account of the life of Japanese swordsman Musashi Miyamoto, based on Eiji Yoshikawa\'s novel Musashi. The story delves into Musashi\'s journey from a brash young man to a legendary swordsman, exploring themes of self-discovery, the pursuit of greatness, and the philosophical aspects of martial arts. It has been serialized in Weekly Morning magazine since 1998, with the chapters collected into 37 tankōbon volumes by Kodansha as of September 2020.')

TheSlamDunk = new Book('The Slam Dunk', 'Takehiko Inoue', 'Started', 276, 'Chapters', 'https://d28hgpri8am2if.cloudfront.net/book_images/cvr9781421533285_9781421533285_hr.jpg', 'Slam Dunk is a Japanese manga series written and illustrated by Takehiko Inoue about a basketball team from Shōhoku High School in the Shōnan area. The story follows Hanamichi Sakuragi, a delinquent and basketball novice, as he joins the school\'s basketball team to impress a girl he likes. Through hard work, determination, and the guidance of his teammates and coach, Hanamichi grows as a player and person, learning valuable life lessons along the way. It was serialized in Shueisha\'s Weekly Shōnen Jump from October 1990 to June 1996, with the chapters collected into 31 tankōbon volumes.')

Berserk = new Book('Berserk', 'Kentaro Miura', 'Completed', 364, 'Chapters', 'https://images.booksense.com/images/205/070/9781593070205.jpg', 'Berserk is a Japanese manga series written and illustrated by Kentaro Miura. Set in a medieval Europe-inspired dark fantasy world, the story centers on the characters of Guts, a lone mercenary, and Griffith, the leader of a mercenary band called the Band of the Hawk. The series explores themes of camaraderie, ambition, and the struggle between good and evil, as Guts battles against both human and supernatural foes. Miura premiered a prototype of Berserk in 1988, and the series has since become renowned for its dark, mature themes and intricate artwork.')

OnePiece = new Book('One Piece', 'Eiichiro Oda', 'Completed', 1000, 'Chapters', 'https://comicvine.gamespot.com/a/uploads/scale_small/11161/111610434/8594314-9160985681-97840.jpg', 'One Piece is a Japanese manga series written and illustrated by Eiichiro Oda. It follows the adventures of Monkey D. Luffy, a boy whose body gained the properties of rubber after unintentionally eating a Devil Fruit. With his pirate crew, Luffy explores the Grand Line in search of the world\'s ultimate treasure known as "One Piece" in order to become the next Pirate King. The series is known for its imaginative world-building, diverse cast of characters, and themes of friendship, freedom, and the pursuit of dreams.')

SteelBallRun = new Book('Steel Ball Run', 'Hirohiko Araki', 'Started', 95, 'Chapters', 'https://m.media-amazon.com/images/I/917WFqQD1mL._AC_UF1000,1000_QL80_.jpg', 'Steel Ball Run is the seventh story arc of the Japanese manga series JoJo\'s Bizarre Adventure, written and illustrated by Hirohiko Araki. Set in 1890, it stars Gyro Zeppeli, a disgraced former executioner, and Johnny Joestar, a former jockey who was shot and lost the use of his legs. The two participate in the Steel Ball Run, a cross-country horse race across America, in pursuit of the grand prize and personal redemption. The series blends historical fiction with supernatural elements, and explores themes of perseverance, friendship, and the human spirit.')

ChainsawMan = new Book('Chainsaw Man', 'Tatsuki Fujimoto', 'Completed', 97, 'Chapters', 'https://images.booksense.com/images/785/722/9781974722785.jpg', 'Chainsaw Man is a Japanese manga series written and illustrated by Tatsuki Fujimoto. The story follows Denji, a young man who merges with his pet devil Pochita to become the titular Chainsaw Man. As a devil hunter, Denji battles against various devils while navigating the complexities of human relationships and his own desires. The series is known for its dark humor, intense action scenes, and exploration of themes such as poverty, ambition, and the nature of humanity.')

VinLandSaga = new Book('Vinland Saga', 'Makoto Yukimura', 'Completed', 54, 'Chapters', 'https://m.media-amazon.com/images/I/91+Qs9DaFZL.jpg', 'Vinland Saga is a Japanese historical manga series written and illustrated by Makoto Yukimura. The series is published by Kodansha, and was first serialized in the youth-targeted Weekly Shōnen Magazine before moving to the monthly manga magazine Afternoon, aimed at young adult readers. The story is set in 11th-century Europe and follows Thorfinn, a young Viking warrior, as he seeks revenge against the mercenary leader Askeladd, who killed his father. The series explores themes of revenge, redemption, and the harsh realities of Viking life.')

TheAlchemist = new Book('The Alchemist', 'Paulo Coelho', 'Unread', 197, 'Pages', 'https://i.harperapps.com/hcuk/covers/9780007487943/x400.jpg?ph=harperreach_coming_soon.png', 'The Alchemist is a novel by Brazilian author Paulo Coelho that was first published in 1988. Originally written in Portuguese, it became a widely translated international bestseller. An allegorical novel, The Alchemist follows a young Andalusian shepherd named Santiago in his journey to the pyramids of Egypt, after having a recurring dream of finding a treasure there. Along the way, he meets various characters who guide him and teach him about the importance of following one\'s dreams, listening to one\'s heart, and recognizing the omens scattered along life\'s path.')

TheHobbit = new Book('The Hobbit', 'J.R.R. Tolkien', 'Unread', 310, 'Pages', 'https://m.media-amazon.com/images/I/712cDO7d73L.jpg' , 'The Hobbit, or There and Back Again is a children\'s fantasy novel by English author J. R. R. Tolkien. It was published on 21 September 1937 to wide critical acclaim, being nominated for the Carnegie Medal and awarded a prize from the New York Herald Tribune for best juvenile fiction. The book remains popular and is recognized as a classic in children\'s literature. The story follows the journey of Bilbo Baggins, a hobbit who is reluctantly drawn into an epic quest to reclaim the lost Dwarf Kingdom of Erebor from the fearsome dragon Smaug.')

TheGreatGatsby = new Book('The Great Gatsby', 'F. Scott Fitzgerald', 'Unread', 180, 'Pages', 'https://m.media-amazon.com/images/I/61OTNorhqVS._AC_UF894,1000_QL80_.jpg', 'The Great Gatsby is a 1925 novel by American writer F. Scott Fitzgerald. Set in the Jazz Age on Long Island, near New York City, the novel depicts first-person narrator Nick Carraway\'s interactions with mysterious millionaire Jay Gatsby and Gatsby\'s obsession to reunite with his former lover, Daisy Buchanan. The novel explores themes of decadence, idealism, resistance to change, social upheaval, and excess, creating a portrait of the Roaring Twenties that has been described as a cautionary tale regarding the American Dream.')

TheHungerGames = new Book('The Hunger Games', 'Suzanne Collins', 'Unread', 374, 'Pages', 'https://m.media-amazon.com/images/I/71un2hI4mcL.jpg', 'The Hunger Games is a 2008 dystopian novel by the American writer Suzanne Collins. It is written in the voice of 16-year-old Katniss Everdeen, who lives in the future, post-apocalyptic nation of Panem in North America. The Capitol, a highly advanced metropolis, exercises political control over the rest of the nation. The story follows Katniss as she volunteers to take her sister\'s place in the Hunger Games, a televised event in which children fight to the death. The novel explores themes of survival, government control, and the effects of violence on society.')

TheLordOfTheRings = new Book('The Lord of the Rings', 'J.R.R. Tolkien', 'Unread', 1178, 'Pages', 'https://s26162.pcdn.co/wp-content/uploads/2017/05/the-lord-of-the-rings-book-cover.jpg', 'The Lord of the Rings is an epic high-fantasy novel by the English author and scholar J. R. R. Tolkien. Set in Middle-earth, the world at some distant time in the past, the story began as a sequel to Tolkien\'s 1937 children\'s book The Hobbit, but eventually developed into a much larger work. The novel is divided into three volumes: The Fellowship of the Ring, The Two Towers, and The Return of the King. It follows the quest to destroy the One Ring, which was created by the Dark Lord Sauron, and the journey of the hobbit Frodo Baggins and his companions.')

TheSilmarillion = new Book('The Silmarillion', 'J.R.R. Tolkien', 'Unread', 365, 'Pages', 'https://m.media-amazon.com/images/I/71Gt0U59D3L._AC_UF894,1000_QL80_.jpg', 'The Silmarillion is a collection of mythopoeic works by English writer J. R. R. Tolkien, edited and published posthumously by his son, Christopher Tolkien, in 1977, with assistance from Guy Gavriel Kay. It is the primary and essential source material for Tolkien\'s Middle-earth legendarium. The book includes several works, the most prominent of which is the "Quenta Silmarillion," which tells the history of the First Age of Middle-earth, including the creation of the world, the rise and fall of the great Elven kingdoms, and the wars against the dark lord Morgoth.')

TheTwoTowers = new Book('The Two Towers', 'J.R.R. Tolkien', 'Unread', 322, 'Pages', 'https://m.media-amazon.com/images/I/71nNxfSvGnL._UF1000,1000_QL80_.jpg', 'The Two Towers is the second volume of J.R.R. Tolkien\'s high fantasy novel The Lord of the Rings. It is preceded by The Fellowship of the Ring and followed by The Return of the King. The story continues the quest to destroy the One Ring, following the separate journeys of the members of the Fellowship after they are scattered. The volume is divided into two books: Book Three, which focuses on the adventures of Aragorn, Legolas, Gimli, Merry, and Pippin, and Book Four, which follows Frodo and Sam as they make their way to Mordor.')

TheFellowshipOfTheRing = new Book('The Fellowship of the Ring', 'J.R.R. Tolkien', 'Unread', 398, 'Pages', 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQoX5QopXUKl6j79ro89axxAkcC253ryvX7Gg&shttps://ic.pics.livejournal.com/tree_lady/14285127/10506/10506_600.jpg', 'The Fellowship of the Ring is the first of three volumes of the epic novel The Lord of the Rings by the English author J. R. R. Tolkien. It is followed by The Two Towers and The Return of the King. The story begins in the Shire, where the hobbit Frodo Baggins inherits the One Ring from his uncle Bilbo. Frodo sets out on a journey to destroy the Ring, accompanied by his friends Sam, Merry, and Pippin, and later joined by Aragorn, Legolas, Gimli, Boromir, and Gandalf. Together, they form the Fellowship of the Ring, united in their quest to save Middle-earth.')

TheReturnOfTheKing = new Book('The Return of the King', 'J.R.R. Tolkien', 'Unread', 347, 'Pages', 'https://www.knjizara-dominovic.hr/upload/catalog/product/8086/249042_the-return-ofthe-king-the-lord-of-the-rings-book-3-return-of-the-king-vol3.jpg', 'The Return of the King is the third and final volume of J.R.R. Tolkien\'s The Lord of the Rings, following The Fellowship of the Ring and The Two Towers. The story begins in the kingdom of Gondor, which is soon to be attacked by the Dark Lord Sauron. The volume is divided into two books: Book Five, which focuses on the war in Gondor and the efforts of Aragorn, Gandalf, and their allies to defend the city, and Book Six, which follows Frodo and Sam as they make their final journey to Mount Doom to destroy the One Ring. The novel concludes with the defeat of Sauron and the restoration of peace to Middle-earth.')


// displayBooks(Vagabond)
//can add genre and summary

myLibrary = [Vagabond, TheSlamDunk, Berserk, OnePiece, SteelBallRun, ChainsawMan, VinLandSaga, TheAlchemist, TheHobbit, TheGreatGatsby, TheHungerGames, TheLordOfTheRings, TheSilmarillion, TheTwoTowers, TheFellowshipOfTheRing, TheReturnOfTheKing];
function Book(title, author, status, length, lengthType, cover, synopsis) {
  // the constructor...
  this.title = title
  this.author = author 
  this.status = status
  this.length = length
  this.lengthType = lengthType
  this.cover = cover
  this.synopsis = synopsis
}

const verticalDots = document.querySelector(".vertical-dots")
verticalDots.addEventListener("click", displayType)

const sort = document.querySelector(".sort")
sort.addEventListener("click", sortBooks)

const search = document.querySelector(".search")
search.addEventListener("click", searchBooks)

const searchBar = document.querySelector("#search-input")
searchBar.addEventListener("input", searchBooks)

function searchBooks(event) {
  const searchContainer = document.querySelector(".search-container")
  if (searchContainer.style.display == "flex") {searchContainer.style.display = "none"}
  else if (search.style.display == "none" || search.style.display == "") {
    searchContainer.style.display = "flex";
  }
  const searchInput = document.querySelector("#search-input")
  searchedArray = new Array();
  myLibrary.forEach(book => {
  if (book.title.toLowerCase().includes(searchInput.value.toLowerCase()) || book.author.toLowerCase().includes(searchInput.value.toLowerCase())) {
    main.innerHTML = "";
    searchedArray.push(book);
  }
  });

  if (searchedArray.length == 0) {
    main.innerHTML = "";
    const noResults = document.createElement("div")
    noResults.textContent = "No results found"
    noResults.style.fontSize = "24px"
    noResults.style.fontWeight = "bold"
    main.appendChild(noResults)
  }
  searchedArray.forEach(book => {displayBooks(book)})
}

function sortBooks(event) {
  const list = document.querySelector("ol")
  list.style.display = "block"

  const sortReadingStatus = document.querySelector(".header > div:nth-child(3) > ol > div")
  sortReadingStatus.addEventListener("mouseenter", sortByStatus)

  list.addEventListener("click", (event) => {
    if (event.target.textContent === "By Title") {
      myLibrary.sort((a, b) => a.title.localeCompare(b.title))
      main.innerHTML = "";
      myLibrary.forEach(book => {displayBooks(book)})
      console.log(myLibrary)
    }
    else if (event.target.textContent === "By Author Name") {
      myLibrary.sort((a, b) => a.author.localeCompare(b.author))
      main.innerHTML = "";
      myLibrary.forEach(book => {displayBooks(book)})
    }
    else if (event.target.textContent === "By Date Added") {
      myLibrary.forEach(book => {displayBooks(book)})
    }
    else if (event.target.textContent === "By Reading Status") {
      const statusList = document.querySelector(".header > div:nth-child(3) > ol > div > ol")
      statusList.style.display = "block"
      statusList.addEventListener("mouseenter", (event) => {statusList.style.display = "block"; sortByStatus(event)})
      statusList.addEventListener("mouseleave", (event) => {statusList.style.display = "none"})
    }
  })
  list.addEventListener("mouseenter", (event) => {list.style.display = "block"})
  list.addEventListener("mouseleave", (event) => {list.style.display = "none"; const statusList = document.querySelector(".header > div:nth-child(3) > ol > div > ol"); statusList.style.display = "none"})
}

function sortByStatus(event) {
  const status = document.querySelector("body > div.container > div.header > div:nth-child(3) > ol > div > ol")
  status.addEventListener("click", (event) => {
    if (event.target.textContent === "Unread") {
      sortUnreadBooks = new Array();
      sortUnreadBooks = myLibrary.filter(book => book.status === "Unread")
      main.innerHTML = "";
      sortUnreadBooks.forEach(book => {displayBooks(book)})
    }
    else if (event.target.textContent === "Started") {
      sortStartedBooks = new Array();
      sortStartedBooks = myLibrary.filter(book => book.status === "Started")
      main.innerHTML = "";
      sortStartedBooks.forEach(book => {displayBooks(book)})
    }
    else if (event.target.textContent === "Completed") {
      sortCompletedBooks = new Array();
      sortCompletedBooks = myLibrary.filter(book => book.status === "Completed")
      main.innerHTML = "";
      sortCompletedBooks.forEach(book => {displayBooks(book)})
    }
  })
}

function displayType(event) {
  const displayList = document.querySelector(".display-list")
  displayList.style.display = "block"
  displayList.addEventListener("click", (event) => {
    if (event.target.textContent == "Regular Grid") {
      main.innerHTML = ""
      main.style = ""
      myLibrary.forEach(book => {displayBooks(book)})
    }
    else if (event.target.textContent == "Compact Grid") {
      const main = document.querySelector(".main")
      main.innerHTML = ""
      main.style.display = "grid"
      main.style.gridTemplateColumns = "repeat(auto-fill, minmax(100px, 0.5fr))"
      main.style.gridGap = "10px"
      main.style.fontSize = "10px"
      myLibrary.forEach(book => {displayBooks(book)})
      const deleteButtons = document.querySelectorAll(".deleteButton")
      deleteButtons.forEach(button => {button.style.position = "relative"; button.style.left = "80%"; button.style.backgroundColor = "rgba(265, 265, 265, 0.5)"; button.style.padding = "0"})
    }
    else if (event.target.textContent == "List view") {}
    else if (event.target.textContent == "Detailed view") {}
  })





  displayList.addEventListener("mouseenter", (event) => {displayList.style.display = "block"})
  displayList.addEventListener("mouseleave", (event) => {displayList.style.display = "none"})
}


function displayBooks(currBook) {
    const main = document.querySelector(".main")

    const book = document.createElement("div")
    book.classList.add("book")

    const cover = document.createElement("div")
    cover.classList.add("book-cover")
    cover.style.backgroundImage = `url(${currBook.cover})`
    cover.style.backgroundSize = "cover"
    cover.style.backgroundPosition = "center"
    cover.addEventListener("mouseenter", bookCoverHover); // Add mouseover event listener
    cover.addEventListener("mouseleave", bookCoverMouseOut); // Add mouseout event listener

    const deleteButton = document.createElement("button");
    deleteButton.classList.add("deleteButton");

    const svg = document.createElementNS("http://www.w3.org/2000/svg", "svg");
    svg.setAttribute("viewBox", "0 0 15 17.5");
    svg.setAttribute("height", "17.5");
    svg.setAttribute("width", "15");
    svg.setAttribute("xmlns", "http://www.w3.org/2000/svg");
    svg.classList.add("icon");

    const iconPath = document.createElementNS("http://www.w3.org/2000/svg", "path");
    iconPath.setAttribute("transform", "translate(-2.5 -1.25)");
    iconPath.setAttribute("d", "M15,18.75H5A1.251,1.251,0,0,1,3.75,17.5V5H2.5V3.75h15V5H16.25V17.5A1.251,1.251,0,0,1,15,18.75ZM5,5V17.5H15V5Zm7.5,10H11.25V7.5H12.5V15ZM8.75,15H7.5V7.5H8.75V15ZM12.5,2.5h-5V1.25h5V2.5Z");
    iconPath.setAttribute("id", "Fill");

    svg.appendChild(iconPath);
    deleteButton.appendChild(svg);
    cover.appendChild(deleteButton);
    deleteButton.addEventListener("click", deleteButtonClick)
    book.appendChild(cover)

    const details = document.createElement("div")
    details.classList.add("book-details")
    book.appendChild(details)

    const title_author = document.createElement("div")

    const title = document.createElement("p")
    title.addEventListener("click", editTitle)
    title.textContent = currBook.title
    title_author.appendChild(title)

    const author = document.createElement("p")
    author.textContent = currBook.author
    author.addEventListener("click", editAuthor)
    title_author.appendChild(author)

    const length = document.createElement("div")
    const lengthValue = document.createElement("span")
    lengthValue.textContent = currBook.length
    lengthValue.addEventListener("click", editLength)
    length.appendChild(lengthValue)
    const lengthType = document.createElement("span")
    lengthType.textContent = " "+currBook.lengthType
    lengthType.addEventListener("click", editLengthType)
    length.appendChild(lengthType)
    title_author.appendChild(length)

    const status = document.createElement("p")
    if (currBook.status === "Unread") {
        status.textContent = "Unread"
        status.style.color = "red"
    }
    else if (currBook.status === "Started") {
        status.textContent = "Started"
        status.style.color = "blue"
    }
    else {
        status.textContent = "Completed"
        status.style.color = "green"
    }

    status.addEventListener("click", statusChange)


    title_author.appendChild(status)

    details.appendChild(title_author)

    
    const buttons = document.createElementNS("http://www.w3.org/2000/svg", "svg");
    buttons.setAttribute("xmlns", "http://www.w3.org/2000/svg");
    buttons.setAttribute("viewBox", "0 0 24 24");
    const titleElement = document.createElementNS("http://www.w3.org/2000/svg", "title");
    titleElement.textContent = "dots-vertical";
    buttons.appendChild(titleElement);

    const path = document.createElementNS("http://www.w3.org/2000/svg", "path");
    path.setAttribute("d", "M12,16A2,2 0 0,1 14,18A2,2 0 0,1 12,20A2,2 0 0,1 10,18A2,2 0 0,1 12,16M12,10A2,2 0 0,1 14,12A2,2 0 0,1 12,14A2,2 0 0,1 10,12A2,2 0 0,1 12,10M12,4A2,2 0 0,1 14,6A2,2 0 0,1 12,8A2,2 0 0,1 10,6A2,2 0 0,1 12,4Z");
    buttons.appendChild(path);
    buttons.addEventListener("click", editButtonClick)
    details.appendChild(buttons);
    
    main.appendChild(book)

}


const plusButton = document.querySelector(".plusButton");
const closeButton = document.querySelector(".closeButton");
const dialog = document.querySelector(".dialog");
const main = document.querySelector(".main");

plusButton.addEventListener("click", () => {
  dialog.showModal();
  main.classList.add("dialog-open"); // Add class to resize container
});

closeButton.addEventListener("click", () => {
  dialog.close();
  main.classList.remove("dialog-open"); // Remove class to resize container back
});

const coverDialog = document.querySelector("input#cover");
coverDialog.addEventListener("input", () => {
  const coverDialogValue = document.querySelector(".dialog>div");
  coverDialogValue.style.border = "2px solid black";
  coverDialogValue.style.backgroundImage = `url(${coverDialog.value})`;
  coverDialogValue.style.backgroundSize = "cover";
  coverDialogValue.style.backgroundPosition = "center";
  coverDialogValue.style.width = "100%";
  coverDialogValue.style.aspectRatio = "2 / 2.75";
  coverDialogValue.style.marginBottom = "5px";
});

confirmBtn.addEventListener("click", (event) => {
  event.preventDefault(); // We don't want to submit this fake form
  const coverDialogValue = document.querySelector(".dialog>div");
  const titleDialog = document.querySelector("input#title").value;
  const authorDialog = document.querySelector("input#author").value;
  const lengthDialog = document.querySelector("#length").value;
  const lengthTypeDialog = document.querySelector('input[name="length"]:checked').value;
  const readStatusDialog = document.querySelector("select").value;
  let newBookName = titleDialog;
  newBookName= new Book(titleDialog, authorDialog, readStatusDialog, lengthDialog, lengthTypeDialog, coverDialog.value);
  myLibrary.push(newBookName);
  myLibrary.forEach(book => {displayBooks(book)})
  dialog.close(); // Have to send the select box value here.
  main.classList.remove("dialog-open"); // Remove class to resize container back
  document.querySelector("form").reset(); // Reset the form
  coverDialogValue.style.border = "none";
  coverDialogValue.style.backgroundImage = "none";
  coverDialogValue.style.width = "0%";
  coverDialogValue.style.aspectRatio = "0";
  coverDialogValue.style.marginBottom = "0";
});

function editButtonClick(event) {

}

function bookCoverHover(event) {
  const cover = event.target.closest(".book-cover");
  const book = myLibrary.find(book => book.title === cover.closest(".book").querySelector(".book-details > div > p:nth-child(1)").textContent);
  const overlay = document.createElement("div");
  overlay.textContent = book.synopsis;
  if(book.synopsis === undefined) {
    overlay.textContent = "Add synopsis";
  }

  // Style the overlay
  overlay.style.height = "100%";
  cover.style.position = "relative";
  overlay.style.position = "absolute";
  overlay.style.top = "0";
  overlay.style.backdropFilter = "blur(2px)";
  overlay.style.padding = "5px";
  overlay.style.width = "100%";
  overlay.style.textShadow = "2px 2px black";


  // Parent height and truncation logic
  const parentHeight = cover.offsetHeight;
  overlay.style.fontSize = "14px"; // Font size
  overlay.style.lineHeight = "24px"; // Line height for consistent row spacing
  overlay.style.maxHeight = `${parentHeight}px`; // Cap the height to parent's height
  overlay.style.overflow = "hidden"; // Hides overflowing content
  overlay.style.whiteSpace = "normal"; // Allows multi-line wrapping
  overlay.style.display = "block"; // Ensure it's a block element
  overlay.style.color = "white";
  overlay.style.wordBreak = "break-word"; // Prevent words from breaking layout

  // Calculate and truncate based on lines
  const maxLines = Math.floor(parentHeight / 24); // Number of lines based on parent height
  overlay.style.display = "-webkit-box"; // Multi-line truncation
  overlay.style.webkitBoxOrient = "vertical";
  overlay.style.webkitLineClamp = maxLines; // Limit to calculated lines

  // Add the overlay to the book cover
  cover.appendChild(overlay);
}


function bookCoverMouseOut(event) {
  const cover = event.target.closest(".book-cover");
  const overlay = cover.querySelector("div");
  if (overlay) {
    overlay.remove();
  }
}

function deleteButtonClick(event) {
  const parentElement = event.target.closest(".book"); 
  const bookToDelete = parentElement.querySelector(".book-details > div > p:nth-child(1)").textContent;
  parentElement.remove();
  myLibrary = myLibrary.filter(book => book.title !== bookToDelete);
}

function editAuthor(event) {
  const authorSelector = event.target.closest(".book-details");
  const authorElement = authorSelector.querySelector("div>p:nth-child(2)");
  const currentAuthor = authorElement.textContent;
  const book = myLibrary.find(book => book.author === currentAuthor);

  // Create a textarea element for editing the author
  const textarea = document.createElement("textarea");
  textarea.value = currentAuthor;
  textarea.style.width = "100%";
  textarea.style.height = "auto";

  // Replace the author element with the textarea
  authorElement.replaceWith(textarea);

  // Focus the textarea and select the text
  textarea.focus();
  textarea.select();

  // Handle the blur event to save the new author
  textarea.addEventListener("blur", () => {
    const newAuthor = textarea.value.trim();
    if (newAuthor) {
      book.author = newAuthor;
      const newAuthorElement = document.createElement("p");
      newAuthorElement.textContent = newAuthor;
      newAuthorElement.style.wordBreak = "break-word";
      textarea.replaceWith(newAuthorElement)
      newAuthorElement.addEventListener("click", editAuthor);
    } else {
      // If the new author is empty, revert to the original author
      textarea.replaceWith(authorElement)
      authorElement.addEventListener("click", editAuthor);
    }
  });
}

function editTitle(event) {
  const titleSelector = event.target.closest(".book-details");
  const titleElement = titleSelector.querySelector("div>p:nth-child(1)");
  const currentTitle = titleElement.textContent;
  const book = myLibrary.find(book => book.title === currentTitle);

  // Create a textarea element for editing the title
  const textarea = document.createElement("textarea");
  textarea.value = currentTitle;
  textarea.style.width = "100%";
  textarea.style.height = "auto";

  // Replace the title element with the textarea
  titleElement.replaceWith(textarea);

  // Focus the textarea and select the text
  textarea.focus();
  textarea.select();

  // Handle the blur event to save the new title
  textarea.addEventListener("blur", () => {
    const newTitle = textarea.value.trim();
    if (newTitle) {
      book.title = newTitle;
      const newTitleElement = document.createElement("p");
      newTitleElement.textContent = newTitle;
      newTitleElement.style.wordBreak = "break-word";
      textarea.replaceWith(newTitleElement)
      newTitleElement.addEventListener("click", editTitle);
    } else {
      // If the new title is empty, revert to the original title
      textarea.replaceWith(titleElement)
      titleElement.addEventListener("click", editTitle);
    }
  });
}

function editLength(event) {
  const lengthSelector = event.target.closest(".book-details");
  const lengthElement = lengthSelector.querySelector("div > div > span:nth-child(1)");
  const currentLength = lengthElement.textContent;
  const book = myLibrary.find(book => book.length == currentLength);
  // Create a textarea element for editing the length
  const textarea = document.createElement("textarea");
  textarea.value = currentLength;
  textarea.style.width = "100%";
  textarea.style.height = "auto";
  textarea.style.boxSizing = "border-box";
  textarea.setAttribute("pattern", "[0-9]*"); // Enforce numeric input

  // Replace the length element with the textarea
  lengthElement.replaceWith(textarea);

  // Focus the textarea and select the text
  textarea.focus();
  textarea.select();

  // Handle the input event to restrict to numeric input
  textarea.addEventListener("input", () => {
    textarea.value = textarea.value.replace(/[^0-9]/g, ''); // Remove non-numeric characters
  });

  // Handle the blur event to save the new length
  textarea.addEventListener("blur", () => {
    const newLength = textarea.value.trim();
    if (newLength) {
      book.length = newLength;
      const newLengthElement = document.createElement("span");
      newLengthElement.textContent = newLength;
      newLengthElement.style.wordBreak = "break-word";
      newLengthElement.style.width = "min-content"
      newLengthElement.addEventListener("click", editLength); // Reattach the click event listener
      textarea.replaceWith(newLengthElement);
    } else {
      // If the new length is empty, revert to the original length
      textarea.replaceWith(lengthElement);
      lengthElement.addEventListener("click", editLength);
    }
  });
}

function editLengthType(event) {
  const lengthTypeSelector = event.target.closest(".book-details");
  const lengthTypeElement = lengthTypeSelector.querySelector("div > div > span:nth-child(2)");
  const currentLengthType = lengthTypeElement.textContent.trim();
  const book = myLibrary.find(book => book.lengthType === currentLengthType);

  // Create a select element for editing the length type
  const select = document.createElement("select");
  select.style.width = "100%";
  select.style.height = "auto";

  // Create the options for the select element
  const options = ["Pages", "Chapters"];
  options.forEach(option => {
    const optionElement = document.createElement("option");
    optionElement.value = option;
    optionElement.textContent = option;
    select.appendChild(optionElement);
  });

  // Set the selected option based on the current length type
  select.value = currentLengthType;

  // Replace the length type element with the select element
  lengthTypeElement.replaceWith(select);

  // Handle the blur event to save the new length type
  select.addEventListener("blur", () => {
    const newLengthType = select.value;
    if (newLengthType) {
      book.lengthType = newLengthType;
      const newLengthTypeElement = document.createElement("span");
      newLengthTypeElement.textContent = " " + newLengthType;
      newLengthTypeElement.style.wordBreak = "break-word";
      newLengthTypeElement.addEventListener("click", editLengthType); // Reattach the click event listener
      select.replaceWith(newLengthTypeElement);
    } else {
      // If the new length type is empty, revert to the original length type
      select.replaceWith(lengthTypeElement);
      lengthTypeElement.addEventListener("click", editLengthType);
    }
  });
}

function statusChange(event) {
  statusSelector = event.target.closest(".book-details")
  const statusToChange = statusSelector.querySelector("div>p:nth-child(1)").textContent;
  const book = myLibrary.find(book => book.title === statusToChange);
  statusSelector = statusSelector.querySelector("div")
  
  if (event.target.textContent === "Unread") {
    event.target.textContent = "Started";
    event.target.style.color = "blue";
  }
  else if (event.target.textContent === "Started") {
    event.target.textContent = "Completed";
    event.target.style.color = "green";
  }
  else {
    event.target.textContent = "Unread";
    event.target.style.color = "red";
  }

  book.status = event.target.textContent;
  statusSelector.appendChild(event.target);


}


myLibrary.forEach(book => {displayBooks(book)})

